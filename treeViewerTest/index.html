<!DOCTYPE html>
<html style="color-scheme: light !important;" translate="no">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="google" content="notranslate">
    <meta name="color-scheme" content="light">

    <meta property="og:title" content="Explore tes origines">
    <meta property="og:description" content="Visualisez votre arbre g√©n√©alogique de mani√®re interactive.">
    <meta property="og:url" content="https://family-tree-pd.vercel.app">
    
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://family-tree-pd.vercel.app/icons/icon-192x192.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="192">
    <meta property="og:image:height" content="192">


    <!-- M√©ta tags pour le mode plein √©cran mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Explore tes origines</title>


    <script>
        // On v√©rifie le localStorage imm√©diatement
        if (localStorage.getItem('modeExpertActif') === 'true') {
            const script = document.createElement('script');
            script.src = "https://cdn.jsdelivr.net/npm/eruda";
            script.onload = () => eruda.init(); // On initialise une fois charg√©
            document.head.appendChild(script);
        }
    </script>



    <!-- SCRIPT DE D√âTECTION DE NAVIGATEUR - DOIT √äTRE EN PREMIER -->
    <script>
        // Traductions
        const T = {
        fr: {
            title: "‚ö†Ô∏è Navigateur compatible ?",
            title2: "‚ö†Ô∏è zoom du Navigateur ?",
            using: "Vous utilisez",
            risk: "‚ö†Ô∏è: Ce navigateur risque d'inverser les couleurs de l'app. <span style='font-weight:bold; color:#002395;'>\"explore tes origines\"</span>. S√©lectionnez \"Sites Lumineux\" ",
            colorRisk: "‚ö†Ô∏è: Ce navigateur va inverser les couleurs de l'app. <span style='font-weight:bold; color:#002395;'>\"explore tes origines\"</span>. S√©lectionnez \"Sites Lumineux\"",
            zoomRiskChrome: "‚ö†Ô∏è: Ce navigateur applique un zoom de {zoom} de l'app. <span style='font-weight:bold; color:#002395;'>\"explore tes origines\"</span>.<br>S√©lectionnez \" ‚ãÆ / Param√®tres / Accessibilit√© / 100%\" ",
            zoomRiskOther: "‚ö†Ô∏è: Ce navigateur applique un zoom de {zoom} de l'app. <span style='font-weight:bold; color:#002395;'>\"explore tes origines\"</span> et risque d'inverser les couleurs. <br>S√©lectionnez \"Sites Lumineux\" et \" ‚ò∞ / Taille du texte / 100%\"",
            solutionsStrong: "Solutions :",
            s1: "Continuer quand m√™me, et activer le mode sites lumineux",
            s1bis: "Continuer quand m√™me, et remettre le zoom √† 100%",
            s1ter: "Continuer quand m√™me, et activer le mode sites lumineux et zoom 100%",
            s2: "Plan B : Ouvrez dans <strong>Chrome</strong> ou <strong>Firefox</strong>",
            s3: "Plan C : Copiez l'URL et coller dans un autre browser",
            chromeBtn: "üöÄ Ouvrir dans Chrome",
            continueBtn: "‚ö†Ô∏è Continuer quand m√™me",
            copyBtn: "üìã Copier l'URL",
            copiedMsg: "‚úÖ URL copi√©e !",
            chromeIntentFailedMsg: "Impossible d'ouvrir Chrome automatiquement.\nOK = Installer Chrome\nAnnuler = Copier l'URL",
            dontShowAgain: "Ne plus afficher ce message",
        },
        en: {
            title: "‚ö†Ô∏è Compatible browser?",
            title2: "‚ö†Ô∏è Browser zoom?",
            using: "You are using",
            risk: "‚ö†Ô∏è: This browser may invert the colors of the app. <span style='font-weight:bold; color:#002395;'>\"explore your origins\"</span>. Select \"Light Sites\" ",
            colorRisk: "‚ö†Ô∏è: This browser will invert the colors of the app. <span style='font-weight:bold; color:#002395;'>\"explore your origins\"</span>. Select \"Light Sites\"",
            zoomRiskChrome: "‚ö†Ô∏è: This browser is applying a {zoom} zoom to the app. <span style='font-weight:bold; color:#002395;'>\"explore your origins\"</span>.<br>Select \" ‚ãÆ / Settings / Accessibility / 100%\" ",
            zoomRiskOther: "‚ö†Ô∏è: This browser is applying a {zoom} zoom and might invert app colors. <span style='font-weight:bold; color:#002395;'>\"explore your origins\"</span>.<br>Select \"Light Sites\" and \" ‚ò∞ / Text size / 100%\"",
            solutionsStrong: "Solutions:",
            s1: "Continue anyway and enable light site mode",
            s1bis: "Continue anyway, and reset zoom to 100%",
            s1ter: "Continue anyway, enable light sites mode and 100% zoom",
            s2: "Plan B: Open in <strong>Chrome</strong> or <strong>Firefox</strong>",
            s3: "Plan C: Copy the URL and paste in another browser",
            chromeBtn: "üöÄ Open in Chrome",
            continueBtn: "‚ö†Ô∏è Continue anyway",
            copyBtn: "üìã Copy URL",
            copiedMsg: "‚úÖ URL copied!",
            chromeIntentFailedMsg: "Cannot open Chrome automatically.\nOK = Install Chrome\nCancel = Copy URL",
            dontShowAgain: "Don't show this message again",
        },
        es: {
            title: "‚ö†Ô∏è ¬øNavegador compatible?",
            title2: "¬ø‚ö†Ô∏è Zoom del navegador?",
            using: "Est√°s usando",
            risk: "‚ö†Ô∏è: Este navegador puede invertir los colores de la aplicaci√≥n <span style='font-weight:bold; color:#002395;'>\"explora tus or√≠genes\"</span>. Selecciona \"Sitios claros\" ",
            colorRisk: "‚ö†Ô∏è: Este navegador invertir√° los colores de la aplicaci√≥n <span style='font-weight:bold; color:#002395;'>\"explora tus or√≠genes\"</span>. Selecciona \"Sitios claros\" ",
            zoomRiskChrome: "‚ö†Ô∏è: Este navegador aplica un zoom de {zoom} a la aplicaci√≥n. <span style='font-weight:bold; color:#002395;'>\"explora tus or√≠genes\"</span>.<br>Seleccione \" ‚ãÆ / Configuraci√≥n / Accesibilidad / 100%\" ",
            zoomRiskOther: "‚ö†Ô∏è: Este navegador aplica un zoom de {zoom} y corre el riesgo de invertir los colores. <span style='font-weight:bold; color:#002395;'>\"explora tus or√≠genes\"</span>.<br>Seleccione \"Sitios claros\" y \" ‚ò∞ / Tama√±o del texto / 100%\"",
            solutionsStrong: "Soluciones :",
            s1: "Continuar de todos modos y activar el modo claro",
            s1bis: "Continuar de todos modos y restablecer el zoom al 100%",
            s1ter: "Continuar de todos modos, activar sitios claros y zoom al 100%",        
            s2: "Plan B : Abre en <strong>Chrome</strong> o <strong>Firefox</strong>",
            s3: "Plan C : Copia la URL y √°brela en otro navegador",
            chromeBtn: "üöÄ Abrir en Chrome",
            continueBtn: "‚ö†Ô∏è Continuar de todos modos",
            copyBtn: "üìã Copiar URL",
            copiedMsg: "‚úÖ URL copiada!",
            chromeAlert: "Si Chrome no se abre, usa el bot√≥n 'Copiar URL'",
            chromeIntentFailedMsg: "No se pudo abrir Chrome autom√°ticamente.\nOK = Instalar Chrome\nCancelar = Copiar URL",
            dontShowAgain: "No mostrar este mensaje de nuevo",
        },
        hu: {
            title: "‚ö†Ô∏è Kompatibilis b√∂ng√©sz≈ë?",
            title2: "‚ö†Ô∏è B√∂ng√©sz≈ë nagy√≠t√°sa?",
            using: "√ñn ezt haszn√°lja:",
            risk: "‚ö†Ô∏è: Ez a b√∂ng√©sz≈ë megford√≠thatja az alkalmaz√°s sz√≠neit <span style='font-weight:bold; color:#002395;'>\"fedezd fel az eredeted\"</span>. V√°lassza a \"Vil√°gos webhelyek\" lehet≈ës√©get ",
            colorRisk: "‚ö†Ô∏è: Ez a b√∂ng√©sz≈ë meg fogja ford√≠tani az app sz√≠neit <span style='font-weight:bold; color:#002395;'>\"fedezd fel az eredeted\"</span>. V√°lassza a \"Vil√°gos webhelyek\" lehet≈ës√©get",
            zoomRiskChrome: "‚ö†Ô∏è: Ez a b√∂ng√©sz≈ë {zoom} nagy√≠t√°st alkalmaz az alkalmaz√°sban. <span style='font-weight:bold; color:#002395;'>\"fedezd fel az eredeteded\"</span>.<br>V√°laszd a \" ‚ãÆ / Be√°ll√≠t√°sok / Kiseg√≠t≈ë lehet≈ës√©gek / 100%\" opci√≥t",
            zoomRiskOther: "‚ö†Ô∏è: Ez a b√∂ng√©sz≈ë {zoom} nagy√≠t√°st alkalmaz √©s felcser√©lheti a sz√≠neket. <span style='font-weight:bold; color:#002395;'>\"fedezd fel az eredeteded\"</span>.<br>V√°laszd a \"Vil√°gos webhelyek\" m√≥dot √©s a \" ‚ò∞ / Sz√∂vegm√©ret / 100%\" opci√≥t",
            solutionsStrong: "Megold√°sok :",
            s1: "Folytassa √≠gy is, √©s kapcsolja be a vil√°gos m√≥dot",
            s1bis: "Folytat√°s mindenk√©ppen, √©s a nagy√≠t√°s vissza√°ll√≠t√°sa 100%-ra",
            s1ter: "Folytat√°s mindenk√©ppen, vil√°gos m√≥d √©s 100%-os nagy√≠t√°s bekapcsol√°sa",        
            s2: "B terv : Nyissa meg <strong>Chrome</strong> vagy <strong>Firefox</strong> b√∂ng√©sz≈ëben",
            s3: "C terv : M√°solja a c√≠met, √©s nyissa meg m√°sik b√∂ng√©sz≈ëben",
            chromeBtn: "üöÄ Megnyit√°s Chrome-ban",
            continueBtn: "‚ö†Ô∏è Folytat√°s m√©gis",
            copyBtn: "üìã URL m√°sol√°sa",
            copiedMsg: "‚úÖ URL m√°solva!",
            chromeAlert: "Ha a Chrome nem ny√≠lik meg, haszn√°lja az 'URL m√°sol√°sa' gombot",
            chromeIntentFailedMsg: "Nem siker√ºlt automatikusan megnyitni a Chrome-ot.\nOK = Chrome telep√≠t√©se\nM√©gse = URL m√°sol√°sa",
            dontShowAgain: "Ne jelenjen meg √∫jra ez az √ºzenet",
        }

        };

        window.redirectLang = 'fr';
        
        let isProblematic = false;
        let browserName = '';
        let isSamsungBrowser = false;
        let isSamsungLikeBrowser = false;
        let innerWidth = 1920;
        let browserScaleFactor = 1;
        let browserScaleFactor_ChromeMethod = 1;
        let browserScaleFactor_SamsungMethod = 1;
        let isMobile = false;
        const MAX_FONT_PIXELS = 100;

        const calcChrome = (baseSize) => { 
            if (isSamsungBrowser || isSamsungLikeBrowser) { return baseSize; }
            else { return Math.min(MAX_FONT_PIXELS, Math.round(baseSize/browserScaleFactor));  }        
        };

        const calcSamsung = (baseSize) => {  
            return Math.round(baseSize/browserScaleFactor); 
            return Math.min(MAX_FONT_PIXELS, Math.round(baseSize/browserScaleFactor));
        };

        function detectBrowserType() { 
        const ua = navigator.userAgent.toLowerCase();   
        isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Macintosh|Mac OS/i.test(navigator.userAgent);
    
        if (/iphone|ipad|ipod/.test(ua)) {
            isProblematic = false;
            if (ua.includes('crios')) browserName = 'Chrome (iOS)';
            else if (ua.includes('fxios')) browserName = 'Firefox (iOS)';
            else browserName = 'Safari';
        } else if (ua.includes('samsungbrowser')) {
            isProblematic = true;
            browserName = 'Samsung Internet';
            isSamsungBrowser = true;
        } else if (ua.includes('miuibrowser') || ua.includes('xbrowser')) {
            isProblematic = true;
            browserName = 'MIUI Browser';
        } else if (ua.includes('oppo')) {
            isProblematic = true;
            browserName = 'Oppo Browser';
        } else if (ua.includes('vivo')) {
            isProblematic = true;
            browserName = 'Vivo Browser';
        } else if (ua.includes('huawei')) {
            isProblematic = true;
            browserName = 'Huawei Browser';
        } else if (ua.includes('ucbrowser')) {
            isProblematic = true;
            browserName = 'UC Browser';
        } else if (ua.includes('android') && !ua.includes('chrome') && !ua.includes('firefox')) {
            isProblematic = true;
            browserName = 'Navigateur syst√®me';
        } else if (ua.includes('edg')) {
            isProblematic = false;
            browserName = 'Edge';
        } else if (ua.includes('chrome')) {
            isProblematic = false;
            browserName = 'Chrome';
        }
        console.log(' - browserName:', browserName);
        }

        function detectBrowserScaleSamsung() {
            const probe = document.createElement("span");
            probe.textContent = "M";
            probe.style.cssText = `
                position: fixed;
                visibility: hidden;
                font-size: 16px;
                line-height: 1;
                padding: 0;
                margin: 0;
            `;

            const container = document.documentElement;
            container.appendChild(probe);
            const computedPx = parseFloat(getComputedStyle(probe).fontSize);
            container.removeChild(probe);
            const scale = computedPx / 16;
            console.log(
                "[detectBrowserScaleSamsung]",
                "computed font-size =", computedPx + "px",
                "=> scale =", scale
            );
            return scale;
        }

        function detectBrowserScale() {
            console.log('\n=== at start in html : ANALYSE SCREEN SIZE / BROWSER WINDOW SIZE / BROWSER ZOOM  ===');
            console.log(' - screen size:', window.screen.width+'x'+window.screen.height);
            console.log(' - screen orientation:', screen.orientation ? screen.orientation.type : 'not available');
            console.log(' - browser external size:', window.outerWidth+'x'+window.outerHeight);
            console.log(' - browser internal size:', window.innerWidth+'x'+window.innerHeight);
            if (isMobile) {
                console.log(' - browser GLOBAL SCALE FACTOR:', window.screen.width / window.innerWidth);
                browserScaleFactor_ChromeMethod = window.screen.width / window.innerWidth; 
            } else {
                console.log(' - devicePixelRatio:', window.devicePixelRatio);
                console.log(' - screen available Size:', window.screen.availWidth+'x'+window.screen.availHeight);
                // console.log(' - F12 DevTools open ?', state.isF12Detected);
                console.log(' - screen physical real width;', (window.innerWidth * window.devicePixelRatio));
                console.log(' - browser window position left:', window.screenX, 'top:', window.screenY, 'right:', window.screenX + window.outerWidth, 'bottom:', window.screenY + window.outerHeight);
                console.log(' - browser text scale factor W :', window.outerWidth / window.innerWidth);
                console.log(' - browser text scale factor H :', window.outerHeight / window.innerHeight );
                console.log(' - browser text scale factor H , corrected:', window.outerHeight*0.875 / window.innerHeight );
                console.log(' - browser GLOBAL SCALE FACTOR:', window.outerWidth / window.innerWidth);
                browserScaleFactor_ChromeMethod = window.outerWidth/ window.innerWidth; 
                // let browserScaleFactor2 = window.outerHeight*0.875 / window.innerHeight; 
                // browserScaleFactor_ChromeMethod = Math.min(browserScaleFactor_ChromeMethod, browserScaleFactor2 )
            }
            if (!isSamsungBrowser) { innerWidth = window.innerWidth*browserScaleFactor_ChromeMethod; }
            else { innerWidth = window.innerWidth;}

            console.log(' -', browserScaleFactor_ChromeMethod,'= browser browserScaleFactor chrome method');
            console.log(' - final browser internal width:', innerWidth);

            //Samsung: utilise le multiplicateur de font-size
            browserScaleFactor_SamsungMethod = detectBrowserScaleSamsung();
            console.log(' - ', browserScaleFactor_SamsungMethod,'= browser browserScaleFactor samsung method');

            if (Math.abs(browserScaleFactor_SamsungMethod - 1) < 0.05) {
                browserScaleFactor = browserScaleFactor_ChromeMethod;
            } else {
                browserScaleFactor = browserScaleFactor_SamsungMethod;
                isSamsungLikeBrowser = true;
            }
            browserScaleFactor = Math.max(Math.min(browserScaleFactor, 6) , 0.20);
            console.log(' -', browserScaleFactor,' = final browser browserScaleFactor. Is Samsung Like Browser ?', isSamsungLikeBrowser);
        }


        function waitForOuterSize(maxFrames = 120) {
            return new Promise((resolve, reject) => {
                let frames = 0;

                function check() {
                    // Si la fen√™tre est enfin mesurable
                    if (window.outerWidth > 0 && window.outerHeight > 0) {
                        console.log('‚úÖ Fen√™tre pr√™te apr√®s', frames, 'essais');
                        resolve({ width: window.outerWidth, height: window.outerHeight });
                        return;
                    }

                    // Sinon, on r√©essaie √† la prochaine image (frame)
                    if (++frames < maxFrames) {
                        requestAnimationFrame(check);
                    } else {
                        console.error('‚ùå Timeout : outerWidth toujours √† 0');
                        // On r√©sout quand m√™me pour ne pas bloquer toute l'appli ind√©finiment
                        resolve({ width: window.innerWidth, height: window.innerHeight });
                    }
                }

                requestAnimationFrame(check);
            });
        }


        // function montrerConsole() {
        //     const el = document.getElementById('eruda');
        //     if (el) {
        //         // On force l'affichage en modifiant le style directement
        //         el.style.setProperty('display', 'block', 'important');
        //         el.style.setProperty('visibility', 'visible', 'important');
        //         el.style.setProperty('opacity', '1', 'important');
        //         el.style.setProperty('pointer-events', 'auto', 'important');
        //         eruda.show(); // Commande interne d'Eruda
        //     }
        // }



        //D√©tection IMM√âDIATE
        (async function () {

        await waitForOuterSize();
        //   montrerConsole();

        detectBrowserType();
        detectBrowserScale();
            // V√©rification imm√©diate : si l'utilisateur a choisi de ne plus voir la modale
        if (localStorage.getItem('hide_browser_warning') === 'true') {
                return; // On arr√™te l'ex√©cution ici, la modale ne s'affichera pas
        }
        const isZoomed = (Math.abs(browserScaleFactor-1) > 0.05);
        //   const zoomPercentVal = Math.round(browserScaleFactor * 100);
        //   const zoomPercentVal = Math.round((browserScaleFactor * 100) / 5) * 5;
        const zoomPercentValTrunc = Math.floor((browserScaleFactor * 100) / 5) * 5;
        const zoomPercentValRound = Math.round((browserScaleFactor * 100) / 5) * 5;
        const deltaTrunc = Math.abs(zoomPercentValTrunc - browserScaleFactor);
        const deltaRound = Math.abs(zoomPercentValTrunc - browserScaleFactor);
        let zoomPercentVal;
        if (deltaTrunc < deltaRound) zoomPercentVal = zoomPercentValTrunc;
        else zoomPercentVal = zoomPercentValRound;

        if (zoomPercentVal >= 200) zoomPercentVal = Math.floor((browserScaleFactor * 100) / 10) * 10;
        if (zoomPercentVal == 130) zoomPercentVal = 125;
        if (zoomPercentVal == 155) zoomPercentVal = 150;
        if (zoomPercentVal == 180) zoomPercentVal = 175;
        if (zoomPercentVal == 510) zoomPercentVal = 500;


        const zoomHtml = `<strong>${zoomPercentVal}%</strong>`;
        console.log('\n\n\n\n=== START === is browser Problematic ?', isProblematic, ' is browser zoomed ?', isZoomed, zoomPercentVal,'%\n\n');


        if (isProblematic || isZoomed) {
        //   if (true) {
            const DEFAULT_LANG = 'fr';
            const saved = localStorage.getItem('redir_lang');
            let LANG = saved || (navigator.language ? navigator.language.slice(0,2) : DEFAULT_LANG);
            if (!T[LANG]) LANG = DEFAULT_LANG;
            window.redirectLang = LANG;


            const t = T[LANG];
            const dark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            let warningMsg = '';
            let solution1Text = '';
            let showAlternateBrowsers = true; // Par d√©faut on montre les boutons Chrome/Copier
            let modalTitle = t.title;

            if (isProblematic && isZoomed) {
                // CAS 3 : Problematic ET Zoom
                // On remplace le marqueur {zoom} par le HTML g√©n√©r√©
                warningMsg = t.zoomRiskOther.replace('{zoom}', zoomHtml);
                solution1Text = t.s1ter;
                showAlternateBrowsers = true; 
            } 
            else if (isProblematic && !isZoomed) {
                // CAS 1 : Problematic seulement (Comportement original)
                warningMsg = dark ? t.colorRisk : t.risk;
                solution1Text = t.s1;
                showAlternateBrowsers = true;
            } 
            else if (!isProblematic && isZoomed) {
                // CAS 2 : Zoom seulement (Browser OK)
                warningMsg = t.zoomRiskChrome.replace('{zoom}', zoomHtml);
                solution1Text = t.s1bis;
                modalTitle = t.title2;
                showAlternateBrowsers = false; // On cache les alternatives car le browser est OK
            }



            // On injecte tes styles de index.html
            const style = document.createElement('style');
            style.textContent = `
            .lang-switch-modal { font-size: ${calcChrome(20)}px; display: flex; justify-content: center; gap: 0.3em; margin-bottom: 0.75em; margin-top: -0.5em; }
            .l-flag { font-size: ${calcSamsung(20)}px; width: 2.2em; height: 1.6em; border-radius: 0.2em; cursor: pointer; border: 0.05em solid #ccc; background-size: cover; opacity: 0.6; transition: 0.2s; }
            .l-flag.active { opacity: 1; outline: 0.1em solid #2196F3; outline-offset: 0.1em; }
            .f-fr { background: linear-gradient(to right, #0055A4 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #EF4135 66.66%); }
            .f-en { background: #012169 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 30'%3E%3Cpath fill='%23012169' d='M0 0v30h60V0z'/%3E%3Cpath stroke='%23fff' d='M0 0l60 30m0-30L0 30'/%3E%3Cpath stroke='%23C8102E' stroke-width='6' d='M0 0l60 30m0-30L0 30'/%3E%3Cpath fill='none' stroke='%23fff' stroke-width='10' d='M30 0v30M0 15h60'/%3E%3Cpath fill='none' stroke='%23C8102E' stroke-width='6' d='M30 0v30M0 15h60'/%3E%3C/svg%3E") center/cover; }
            .f-es { background: linear-gradient(to bottom, #C60B1E 25%, #FFC400 25%, #FFC400 75%, #C60B1E 75%); }
            .f-hu { background: linear-gradient(to bottom, #CE2939 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #477050 66.66%); }
            `;
            document.head.appendChild(style);

            document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.createElement('div');
            overlay.id = 'browser-warning-overlay';
            overlay.dataset.role ="fontSizeChangeChrome0";
            overlay.style.cssText = `
                position: fixed;
                font-size: ${calcChrome(10)}px;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('./background_images/tree-log-lowQuality.jpg') no-repeat center center;
                background-size: cover;
                z-index: 999999;
                display: flex;
                align-items: center;      /* Centrage vertical */
                justify-content: center;   /* Centrage horizontal */
                padding: 1em;
                box-sizing: border-box;
                border-radius: 0.6em;
            `;
            const container = document.createElement('div');
            container.style.cssText = 'font-size:${calcChrome(10)}px;background:white;border-radius:1.2em;padding:2.0em;padding-top:2.5em;width:100%;max-width:32em;margin:0 auto;box-sizing:border-box;max-height:90vh;overflow-y:auto;box-shadow:0 2em 3em rgba(0,0,0,0.3);';
            container.dataset.role ="fontSizeChangeChrome0";



            // Pr√©paration du HTML pour les boutons additionnels (Chrome / Copy)
            const extraButtonsHTML = showAlternateBrowsers ? `
                <button data-role ="fontSizeChangeChrome0" onclick="tryChrome()" style="font-size:${calcChrome(15)}px; border-radius: 0.3em; display:block;width:100%;padding:0.5em;background:#ff9800;color:white;border:none;border-radius:0.625em;font-weight:bold;cursor:pointer;margin:0.325em 0; margin-bottom:0.5em;">
                    <span data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px;">${t.chromeBtn}</span>
                </button>          
                <button data-role ="fontSizeChangeChrome0" onclick="copyUrl()" style="font-size:${calcChrome(15)}px; border-radius: 0.3em; display:block;width:100%;padding:0.5em;background:#4CAF50;color:white;border:none;border-radius:0.625em;font-weight:bold;cursor:pointer;margin:0.325em 0;">
                    <span data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px;">${t.copyBtn}</span>
                </button>
            ` : '';

            // Pr√©paration du HTML pour la liste des solutions (Plan B et C)
            const extraSolutionsHTML = showAlternateBrowsers ? `
                <li data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px; margin:0.3em 0;">${t.s2}</li>
                <li data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px; margin:0.3em; margin-bottom:0">${t.s3}</li>
            ` : '';

            container.innerHTML = `
                <div class="lang-switch-modal" role = "fontSizeChangeChrome0" >
                    <div class="l-flag f-fr ${LANG==='fr'?'active':''}" role = "fontSizeChangeChrome0" onclick="setModalLang('fr')"></div>
                    <div class="l-flag f-en ${LANG==='en'?'active':''}" role = "fontSizeChangeChrome0" onclick="setModalLang('en')"></div>
                    <div class="l-flag f-es ${LANG==='es'?'active':''}" role = "fontSizeChangeChrome0" onclick="setModalLang('es')"></div>
                    <div class="l-flag f-hu ${LANG==='hu'?'active':''}" role = "fontSizeChangeChrome0" onclick="setModalLang('hu')"></div>
                </div>
                <h1 data-role ="fontSizeChange0" style="font-size:${calcSamsung(17)}px; white-space:nowrap;margin-top:0px;margin-bottom:0.2em;margin-top:-0.2em;padding:0;color:#333;text-align:center;">${modalTitle}</h1>
                <p data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px; color:#666;line-height:1.4;margin-bottom:1.2em;margin-top:-0.2em;text-align:center;">${t.using} <span style="color:#667eea;font-weight:bold;background:#f0f0f0;padding:0.25em 10px;border-radius:0.25em;display:inline-block;">${browserName}</span></p>
                <p data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px; color:#666;line-height:1.4;margin-bottom:0.8em;text-align:center;margin-top:-0.7em;">${warningMsg}</p>

                <button data-role ="fontSizeChangeChrome0" onclick="continueToApp()" style="font-size:${calcChrome(15)}px; border-radius: 0.3em; display:block;width:100%;padding:0.5em;background:#2196F3;color:white;border:none;border-radius:0.625em;font-weight:bold;cursor:pointer;margin:0.325em 0;margin-top:-0.5em; margin-bottom:0.5em;">
                    <span data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px;">${t.continueBtn}</span>
                </button>

                ${extraButtonsHTML}

                <div data-role ="fontSizeChangeChrome0" style="font-size: ${calcSamsung(14)}px; display: flex; align-items: center; justify-content: center; gap: 0.5em; margin: 0.4em; margin-top: -0.1em ; cursor: pointer;">
                    <input data-role ="fontSizeChangeChrome0" type="checkbox" id="dont-show-again" style="font-size: ${calcChrome(10)}px; width: 1.8em; height: 1.8em; cursor: pointer; box-sizing: border-box; border-radius: 0.4em; border:0.2em solid #afaeae; "
                    <label data-role ="fontSizeChange0"  for="dont-show-again" style="font-size: ${calcChrome(10)}px; color: #666; cursor: pointer; user-select: none;">
                        ${t.dontShowAgain}
                    </label>
                </div>


                <div data-role ="fontSizeChangeChrome0" style="font-size:${calcChrome(10)}px; border-radius: 0.3em; background:#f8f9fa;border-radius:1em;padding:.5em; padding-top:0.5em; padding-bottom:0.2em;margin:0; margin-top:-0.5em">
                <strong data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px;display:block;margin-bottom:0;">${t.solutionsStrong}</strong>
                <ol data-role ="fontSizeChangeChrome0" style="font-size:${calcChrome(10)}px; padding-left:2em;color:#444;margin:0;">
                    <li data-role ="fontSizeChange0" style="font-size:${calcSamsung(15)}px; margin:0.3em 0;">${solution1Text}</li>
                    ${extraSolutionsHTML}
                </ol>
                </div>
            `;
            
            overlay.appendChild(container);
            document.body.appendChild(overlay);
            });
        }
        })();

        function continueToApp() {
            savePreferenceAndClose();
            const overlay = document.getElementById('browser-warning-overlay');
            if (overlay) overlay.remove();
        }

        function tryChrome() {
        const currentUrl = window.location.href;
        const url = currentUrl.replace('https://', '');
        const intentUrl = `intent://${url}#Intent;scheme=https;package=com.android.chrome;end`;
        const playStoreUrl = 'https://play.google.com/store/apps/details?id=com.android.chrome';
        const start = Date.now();

        window.location.href = intentUrl;

        setTimeout(() => {
            if (document.visibilityState === 'visible' && Date.now() - start < 3000) {
            const msg = (T && T[window.redirectLang] && T[window.redirectLang].chromeIntentFailedMsg) ?
                            T[window.redirectLang].chromeIntentFailedMsg :
                            "Impossible d'ouvrir Chrome automatiquement.\nOK = Installer Chrome\nAnnuler = Copier l'URL";

            if (confirm(msg)) {
                try { window.open(playStoreUrl, '_blank'); }
                catch (e) { window.location.href = playStoreUrl; }
            } else {
                try { copyUrl(); }
                catch (e) { 
                navigator.clipboard && navigator.clipboard.writeText(currentUrl); 
                alert("URL copi√©e !");
                }
            }
            }
        }, 1800);
        savePreferenceAndClose();
        }

        function copyUrl() {
        const url = window.location.href;
        const textArea = document.createElement('textarea');
        textArea.value = url;
        textArea.style.position = 'fixed';
        textArea.style.left = '-9999px';
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
            document.execCommand('copy');
            const msg = document.createElement('div');
            msg.style.cssText = 'color:#4CAF50;font-weight:bold;text-align:center;margin-top:10px;';
            msg.textContent = T[window.redirectLang] ? T[window.redirectLang].copiedMsg : T['fr'].copiedMsg;
            const steps = document.querySelector('#browser-warning-overlay div > div:nth-child(3)');
            if (steps) {
            steps.after(msg);
            setTimeout(() => msg.remove(), 2000);
            }
        } catch (err) {
            alert('Copiez manuellement : ' + url);
        }
        
        document.body.removeChild(textArea);
        savePreferenceAndClose();
        }


        function savePreferenceAndClose() {
            const checkbox = document.getElementById('dont-show-again');
            if (checkbox && checkbox.checked) {
                localStorage.setItem('hide_browser_warning', 'true');
            }
            const overlay = document.getElementById('browser-warning-overlay');
            if (overlay) overlay.remove();
        };




        window.setModalLang = function(lang) {
        localStorage.setItem('redir_lang', lang);
        location.reload(); // On recharge pour appliquer la langue partout proprement
        };



    </script>


    
    <!-- A ENLEVER !!!!!!!!!!!!!!!!!!   code pour d√©sactiver le service worker et vider les caches -->
    <!-- pour d√©bugger sur IOS o√π le service worker pose probl√®me -->
    <!-- <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for (let registration of registrations) {
                    registration.unregister();
                }
            });
        }

        if ('caches' in window) {
            caches.keys().then(function(names) {
                for (let name of names) {
                    caches.delete(name);
                }
            });
            console.log("Caches d'API supprim√©s");
        }
        // Optionnel : vider aussi le localStorage si besoin
        // localStorage.clear();
    </script> -->
    <!-- FIN A ENLEVER !!!!!!!!!!!!!!!!!!   code pour d√©sactiver le service worker et vider les caches -->



    <!-- Google tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HWT22W45CN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-HWT22W45CN');
    </script>


    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> -->
    <!-- <link rel="stylesheet" href="js/treeWheelStyles.css"> -->


    <!-- Script d'enregistrement am√©lior√© du Service Worker -->
    <!-- <script src="js/serviceWorkerInit.js"></script>

    <script src="js/i18n.js"></script> -->


    <script src="./cacheConfig.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="./css/styles.css">

    <!-- Syst√®me de chargement des biblioth√®ques avec fallback -->
    <!-- <script type="module" src="js/libraryLoader.js" defer></script> -->

    <!-- Initialisation de l'application -->
    <script type="module" src="js/appInitializer.js"></script>
    
   
    
    <!-- Script d'initialisation qui attend le chargement des biblioth√®ques -->
    <!-- <script>
        document.addEventListener('libraries-loaded', function() {
            console.log("Toutes les biblioth√®ques sont charg√©es, initialisation de l'application...");
            // Vous pouvez initialiser ici les composants qui d√©pendent des biblioth√®ques externes
        });
    </script> -->
    <link rel="manifest" href="./manifest.webmanifest">

    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">

    <script src="js/pwaInstaller_ProgressiveWebApps.js"></script>


</head>



<body>
    <div class="login-background">
        <!-- <img src="background_images/fort_lalatte.jpg" class="login-background-image" alt="Fond d'√©cran"> -->
        <!-- <img src="background_images/bois.jpg" class="login-background-image" alt="Fond d'√©cran">         -->
        <img id="login-background-image" src="./background_images/tree-log-lowQuality.jpg" class="login-background-image" alt="Fond d'√©cran">  
        <!-- <img class="login-background-image" alt="Fond d'√©cran"> -->
    </div>


    <!-- Bouton pour ouvrir la modal de chargement de fichier -->
    <button id="load-gedcom-button" data-role ="button1" class="settings-button" onclick="openGedcomModal()" style=" top: 10px;  font-size: 34px; background: transparent; border: none; cursor: pointer;" ><span>‚öôÔ∏è</span></button>
    <!-- <button id="help-button" data-role ="button1" class="help-button" onclick="documentation()" style=" position: fixed; top: 10px;  right: 10px; font-size: 34px; background: transparent; border: none; cursor: pointer;" ><span>üí°</span></button> -->
    <button id="help-button" data-role ="button1" class="help-button" style=" position: fixed; top: 10px;  right: 10px; font-size: 34px; background: transparent; border: none; cursor: pointer;" ><span>üí°</span></button>

    <!-- <div id="fullScreenLabel" data-role ="fontSizeChange1" class="fullScreenLabel" data-text-key="fullScreenLabel" style="font-size: 11px; position: fixed; z-index: 2; bottom: 3.75em; left: 0.42em;  color: white; margin-top: 0px; margin-bottom: 0.17em; padding-top:0; padding-bottom:0; text-align: center;">fullScreen</div> -->

    <div id="fullScreenLabel" data-role ="fontSizeChangeChrome1" class="fullScreenLabel"  style="font-size: 11px; position: fixed; z-index: 2; bottom: 3.1em; left: 0.42em;  color: white; margin-top: 0px; margin-bottom: 0.17em; padding-top:0; padding-bottom:0; text-align: center;">
        <span data-text-key="fullScreenLabel" data-role ="fontSizeChange1" style="font-size: 10px;">fullScreen</span>
    </div>


    <button id="fullScreen-button" data-role ="fontSizeChangeChrome1" class="fullScreen-Button"   onclick="toggleFullScreen()" data-text-key="fullScreen" style="font-size: 10px; position: fixed; z-index: 1499; bottom: 0.4em; left: 0.7em; padding: 0; margin:0; background: transparent; border: none; cursor: pointer;"><span>üñ•Ô∏è</span></button>
<!-- bottom: 0.09em; -->
    <div id="browserBarLabel" class="browserBarLabel" data-text-key="hideBrowserBarLabel" style="display: none; position: fixed; z-index: 2; bottom: 35px; left: 50%; transform: translateX(-50%); font-size: 12px; white-space: pre-line; color: white; margin-top: 0px; margin-bottom: 2px; padding-top:0; padding-bottom:0; text-align: center;">browser<br>Bar</div>
    <!-- <button id="browserBar-button" data-role ="button1" class="browserBar-Button"   onclick="browserBarPuzzle()" data-text-key="browserBar" style="display: none; position: fixed; z-index: 2; bottom: 3px;  font-size: 28px; background: transparent; border: none; cursor: pointer;"><span>üíª</span></button> -->
    <button id="browserBar-button" data-role ="button1" class="browserBar-Button"  data-text-key="browserBar" style="display: none; position: fixed; z-index: 2; bottom: 3px;  font-size: 28px; background: transparent; border: none; cursor: pointer;"><span>üíª</span></button>


    <div id="advanced-settings-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow-y: auto;">
    

        <div data-role ="fontSizeChangeChromeAdvanced" style="background-color: white; font-size: 10px; width: 34em; max-width: 90%; border-radius: 1em; box-shadow: 0 0.4em 0.6em rgba(0,0,0,0.1); text-align: center; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); max-height: 90vh; overflow-y: auto;">
            <!-- <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; "> -->
            <div data-role ="fontSizeChangeChromeAdvanced"  style="font-size: 10px; display: flex; justify-content: space-between; align-items: center;  /* STYLES DU BANDEAU */ background-color: #E0F7FA;  padding: 0.3em 2em; margin-bottom: 0;  border-radius: 1em 1em 0 0;  border-bottom: 0.1em solid #B2EBF2;">
                <h2 data-role ="fontSizeChangeAdvanced" id="advancedSettingsTitle" style="margin: 0; font-size: 16px; color: #333;" data-text-key="AdvancedUserMenu">Advanced user menu</h2>
                <span data-role ="button1" onclick="closeGedcomModal()" id="advancedSettingsClose-btn" style="cursor: pointer; font-size: 24px; color: #999;">&times;</span>
            </div>
            <div id="insertionPointForInstallButton" style="font-size: 10px; padding: 2em; padding-left: 2.5em;" data-role ="fontSizeChangeChrome1">
                <!-- <input type="file" id="gedFile" accept=".ged" style="width: 100%; margin-bottom: 15px; padding: 8px; box-sizing: border-box;"> -->
                <!-- Cacher l'input file original -->
                <input type="file" id="gedFile" accept=".ged" style="display: none;">

                <div data-role ="fontSizeChangeChromeAdvanced"  style="font-size: 10px;  width: 100%; max-width: 30em; height: 4em; background-color: #4CAF50; border-radius: 3px;  margin-top: -1.5em; margin-bottom: 1em; padding: 0.5em; box-sizing: border-box;">
                    <button data-role ="buttonAdvanced" id="SWUpdateBtn" onclick="SWUpdate()" data-text-key="SWUpdate" style="font-size: 16px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        Mise √† jour du logiciel
                    </button>
                </div>


                <div data-role ="fontSizeChangeChromeAdvanced"  style="font-size: 10px;  width: 100%; max-width: 30em; height: 4em; background-color: #9c27b0; border-radius: 3px; margin-bottom: 1em; padding: 0.5em; box-sizing: border-box;">
                    <button data-role ="buttonAdvanced"id="defaultSettingsBtn" onclick="resetToDefaultSettings()" data-text-key="parametresDefaut" style="font-size: 16px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        üîÑ Param√®tres par d√©faut
                    </button>
                </div>

                
                <div data-role ="fontSizeChangeChromeAdvanced"  style="font-size: 10px;  width: 100%; max-width: 30em; height: 4em; background-color: #4c93af; border-radius: 3px; margin-bottom: 1em; padding: 0.5em; box-sizing: border-box;">
                    <!-- <button data-role ="buttonAdvanced" id="voiceBtn" onclick="voiceModal()" data-text-key="voiceModal"style="font-size: 16px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;"> -->
                    <button data-role ="buttonAdvanced" id="voiceBtn" data-text-key="voiceModal"style="font-size: 16px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        üó£Ô∏è s√©lection de la voix
                    </button>
                </div>                


                <!-- Label pour le fichier GEDCOM -->
                <!-- <label id="labelGedFile"  data-role ="fontSizeChangeChrome1" for="gedFile" style="display: block; font-size: 10px; color: #333; margin-top: 2em; margin-bottom: 0.3em; font-weight: 500;" data-text-key="fichierGedcom">
                    <span id="labelGedFileSpan" data-role ="fontSizeChange1"  class="label-text" style="font-size: 14px;">GEDCOM file</span>
                </label> -->

                <label id="labelGedFile"  data-role ="fontSizeChangeAdvanced" class="label-text" for="gedFile" style="display: block; font-size: 13px; color: #333; margin-top: 1.4em; margin-bottom: 0.2em; font-weight: 500;" data-text-key="fichierGedcom">
                    GEDCOM file
                </label>


                <div style="font-size: 10px; width: 100%; max-width: 30em; display: flex; margin-bottom: 0px; align-items: stretch; height: auto;">
                    <div data-role ="fontSizeChangeChromeAdvanced"  style="font-size: 10px;  flex-shrink: 0; width: 8em; height: 6em; background-color: #4361ee; border-radius: 3px; padding: 0.6em; box-sizing: border-box;">
                        <button data-role ="buttonAdvanced" id="gedFileBtn" onclick="document.getElementById('gedFile').click();" data-text-key="choisirFichier" 
                                style="font-size: 13px; width: 100%; line-height: 1.2; height: 100%; background: transparent; color: white; border: none; border-radius: 3px; cursor: pointer; margin: 0; padding: 0;">
                            Choisir un fichier
                        </button>
                    </div>

                    <span data-role ="fontSizeChangeChromeAdvanced" id="fileNameDisplay" style="font-size: 10px; flex-grow: 1; padding: 1em; border: 1px solid #ccc; border-left: none; border-right: none; 
                                                    box-sizing: border-box; /* IMPORTANT : pour inclure le padding dans les 300px */
                                                    display: block;        /* IMPORTANT : pour que le box-sizing s'applique correctement */
                                                    border-radius: 0; background-color: #f9f9f9; text-align: left; 
                                                    overflow: hidden; /* Permet le saut de ligne */
                                                    text-overflow: ellipsis; 
                                                    align-self: stretch;
                                                    line-height: 1.2; /* Permet le saut de ligne */
                                                    max-height: 6em; /*40px;  Limite la hauteur √† environ 2 lignes de texte */
                                                    white-space: normal;"> 
                                                    <span data-role ="fontSizeChangeAdvanced" class="label-text" style="font-size: 14px;  margin: 0; padding: 0;">Aucun fichier choisi</span>
                    </span>

                    <div data-role ="fontSizeChangeChromeAdvanced" id="showTreeBtnDiv" style="font-size: 10px;  flex-shrink: 0; width: 8em; height: 6em; background-color: #4CAF50; border-radius: 3px; padding: 0.6em; box-sizing: border-box; display: none;">
                        <button data-role ="buttonAdvanced" id="showTreeBtn" onclick="loadData('nonEncrypted'); closeGedcomModal()" data-text-key="afficherArbre" 
                                style="font-size: 14px; width: 100%; line-height: 1.2; height: 100%; background: transparent; color: white; border: none; border-radius: 3px; cursor: pointer; margin: 0; padding: 0; display: none;">
                            Afficher l'arbre
                        </button>
                    </div>
                </div>

                <!-- Ajouter un script pour mettre √† jour le nom du fichier s√©lectionn√© -->
                <script>
                    document.getElementById('gedFile').addEventListener('change', function() {
                        var fileNameDisplay = document.getElementById('fileNameDisplay');
                        var showTreeBtn = document.getElementById('showTreeBtn'); // R√©cup√©ration du bouton
                        var showTreeBtnDiv = document.getElementById('showTreeBtnDiv'); // R√©cup√©ration du div contenant le bouton
                        
                        if (this.files.length > 0) {
                            // Affichage du nom du fichier
                            fileNameDisplay.textContent = this.files[0].name;
                            fileNameDisplay.removeAttribute('data-text-key');
                            
                            // Affichage du bouton vert
                            showTreeBtn.style.display = 'block';
                            showTreeBtnDiv.style.display = 'block';

                        } else {
                            // R√©tablissement du texte par d√©faut
                            fileNameDisplay.textContent = window.i18n ? window.i18n.getMultilingueText('aucunFichier') : 'Aucun fichier choisi';
                            fileNameDisplay.setAttribute('data-text-key', 'aucunFichier');
                            
                            // Masquage du bouton vert
                            showTreeBtn.style.display = 'none';
                            showTreeBtnDiv.style.display = 'none'; 
                        }
                    });
                </script>

                <div data-role ="fontSizeChangeChromeAdvanced"  class="expert-hidden" style="font-size: 10px;  width: 100%; max-width: 30em; height: 4em; background-color: #d42f48; border-radius: 3px; margin-top: 1em; padding: 0.5em; box-sizing: border-box;">
                    <!-- <button data-role ="buttonAdvanced" id="activateDebugLogsBtn" onclick="activateDebugLogs()" data-text-key="activerLogs" class="expert-hidden" style="font-size: 14px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;"> -->
                   <button data-role ="buttonAdvanced" id="activateDebugLogsBtn" data-text-key="activerLogs" class="expert-hidden" style="font-size: 14px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        üêû Activer les logs de debug
                    </button>
                </div>   

                <div data-role ="fontSizeChangeChromeAdvanced" class="expert-hidden" style="font-size: 10px;  width: 100%; max-width: 30em; height: 4em; background-color: #d55266; border-radius: 3px; margin-top: 1em; padding: 0.5em; box-sizing: border-box;">
                    <!-- <button data-role ="buttonAdvanced" id="activateAccelerometerBtn"  onclick="toggleAccelerometer()" data-text-key="activerAccel" class="expert-hidden" style="font-size: 14px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;"> -->
                    <button data-role ="buttonAdvanced" id="activateAccelerometerBtn" data-text-key="activerAccel" class="expert-hidden" style="font-size: 14px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        üß≠ Activer l'acc√©l√©rom√®tre
                    </button>
                </div> 

                <div data-role ="fontSizeChangeChromeAdvanced" class="expert-hidden" style="font-size: 10px;  width: 100%; max-width: 30em; height: 4em; background-color: #d42f74; border-radius: 3px; margin-top: 1em; padding: 0.5em; box-sizing: border-box;">
                    <!-- <button data-role ="buttonAdvanced" id="openCameraModalBtn"  onclick="openCameraModal()" data-text-key="openCameraModal" class="expert-hidden" style="font-size: 13px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;"> -->
                    <button data-role ="buttonAdvanced" id="openCameraModalBtn" data-text-key="openCameraModal" class="expert-hidden" style="font-size: 13px; width: 100%; height: 100%; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        üé• Cam√©ra & R√©alit√© Augment√©e
                    </button>
                </div> 
                
                <div data-role ="fontSizeChangeChromeAdvanced" class="expert-hidden" style="font-size: 10px; display: flex; align-items: center; justify-content: center; gap: 0.5em; margin: 0.4em; cursor: pointer; ">
                    <input data-role ="fontSizeChangeAdvanced" type="checkbox" id="dont-apply-button-rescale" style="font-size: 10px; width: 1.8em; height: 1.8em; cursor: pointer; box-sizing: border-box; border-radius: 0.2em; border:0.2em solid #afaeae; ">  
                    <label data-role ="fontSizeChangeAdvanced" id="dont-apply-button-rescale-label" for="dont-apply-button-rescale" style="font-size: 14px; color: #666; cursor: pointer; user-select: none;">
                        do not apply button rescale
                    </label>
                </div>
            </div>
            <div id="cache-status" style="margin-top: 10px; font-size: 14px; display: none;"></div>
        </div>

    </div>


    <!-- Formulaire de mot de passe -->
    <div id="password-form" style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh;">    

        <div id="language-selector-container" data-role ="fontSizeChangeChrome1" style="font-size: 10px; display: none; position: fixed; top: 0; margin-top: -1em; z-index: 1; pointer-events: none;">
            <div id="language-selector" data-role ="fontSizeChangeChrome1" class="language-selector" style="font-size: 10px; display: flex; justify-content: center; background-color: rgba(255, 255, 255, 0.8); padding: 0.5em; border-radius: 0.8em; box-shadow: 0 0.2em 0.5em rgba(0, 0, 0, 0.2); pointer-events: auto; margin-top: 1.5em; gap: 1em;">
                <div id="french" data-role ="fontSizeChangeChrome1" class="lang-flag flag-fr active" data-lang="fr" title="Fran√ßais" onclick="window.i18n.changeLanguage('fr'); "></div>
                <div id="english" data-role ="fontSizeChangeChrome1" class="lang-flag flag-en" data-lang="en" title="English" onclick="window.i18n.changeLanguage('en'); "></div>
                <div id="spanish" data-role ="fontSizeChangeChrome1" class="lang-flag flag-es" data-lang="es" title="Espa√±ol" onclick="window.i18n.changeLanguage('es'); "></div>
                <div id="hungarian" data-role ="fontSizeChangeChrome1" class="lang-flag flag-hu" data-lang="hu" title="Magyar" onclick="window.i18n.changeLanguage('hu'); "></div>
            </div>
        </div>
        

        <div  id="formContainer"  data-role ="fontSizeChangeChrome1" class="form-container" 
            style="display: none; position: fixed; font-size: 10px; width: 28em; max-width: 28em; top: 8em; padding: 2em; padding-top: 1em; padding-bottom: 0.5em; text-align: center; box-sizing: border-box;  overflow-y: auto; border-radius: 0.85em; border:0.1em solid #afaeae; box-shadow: 0 0.4em 0.6em  rgba(0,0,0,0.1); background-color: rgba(255, 255, 255, 0.9);">

            <div id="nameRow" data-role ="fontSizeChangeChrome1" id="nameRow" class="name-row" style="display: flex; font-size: 10px; gap: 0.8em; margin-top: 0px; margin-bottom: 0.4em; max-width: 24em; width: 100%; margin-left: auto; margin-right: auto;">

                <div data-role ="fontSizeChangeChrome1" style="display: flex; flex-direction: column; justify-content: flex-end; flex: 1 1 0; font-size: 18px; padding: 0px; margin-left: -1.22em; margin-right: -0.83em; height: auto; ">
                    <!-- <button id="voiceCommandBtn" data-role ="button1"  onclick="voiceCommand('start')" style="font-size: 18px; width: 100%; color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 0; padding: 0; background: transparent;"> -->
                    <button id="voiceCommandBtn" data-role ="button1"  style="font-size: 18px; width: 100%; color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 0; padding: 0; background: transparent;">
                        üéôÔ∏è
                    </button>
                </div>

                <div id="firstNameContainer" data-role ="fontSizeChangeChrome1"  style="display: flex; flex-direction: column; flex: 1 1 0; font-size: 10px; width: 11.5em;">
                    <small id="firstNameContainerDetail" data-role ="fontSizeChangeChrome1"  style="font-size: 9px; color: #888; margin-top: 0px; margin-bottom: 0.45em; padding-top:0; padding-bottom:0; text-align: center;">
                        <span id="prenomLabel" data-role ="fontSizeChange1"  data-text-key="inputFormFirstName" class="label-text" style="font-size: 9px;">pr√©nom</span>
                    </small>

                    <div id="firstNameInputContainer" data-role ="fontSizeChangeChrome1"  style="font-size: 10px; width: 11.5em; height: 2.8em; margin-top: 0px; display: inline-block; vertical-align: middle;">
                        <input id="input-form-firstName" data-role ="fontSizeChange1" type="text"  placeholder="pr√©nom" data-text-key="inputFormFirstName" autocomplete="off" 
                            style="font-size: 10px; width: 100%; height: 100%; text-align: center; box-sizing: border-box; border: 0.1em solid #767676; margin: 0; padding: 0; border-radius: 0.3em; outline: none;"
                            onfocus="this.style.border='0.2em solid black';"  onblur="this.style.border='0.1em solid #767676';">
                    </div>
                </div>

                <div id="lastNameContainer" data-role ="fontSizeChangeChrome1"  style="display: flex; flex-direction: column; flex: 1 1 0; font-size: 10px; width: 11.5em;">
                    <small id="lastNameContainerDetail" data-role ="fontSizeChangeChrome1"  style="font-size: 9px; color: #888; margin-top: 0px; margin-bottom: 0.45em; margin-left: -1em; padding-top:0; padding-bottom:0; text-align: center;">
                        <span id="nomLabel" data-role ="fontSizeChange1"  data-text-key="inputFormLastNameComment" class="label-text" style="font-size: 9px;">nom (jeune fille)</span>
                    </small>

                    <div id="lastNameInputContainer"  data-role ="fontSizeChangeChrome1" style="font-size: 10px; width: 11.5em; height: 2.8em; margin-top: 0px; display: inline-block; vertical-align: middle;">
                        <input id="input-form-lastName" data-role ="fontSizeChange1" type="text"  placeholder="nom" data-text-key="inputFormLastName" autocomplete="off" 
                            style="font-size: 10px; width: 100%; height: 100%; text-align: center; box-sizing: border-box; border: 0.1em solid #767676; margin: 0; padding: 0; border-radius: 0.3em; outline: none;"
                            onfocus="this.style.border='0.2em solid black';"  onblur="this.style.border='0.1em solid #767676';">
                    </div>    
                </div>
            </div>

            <div data-role ="fontSizeChangeChrome1" class="password-row" style="display: flex; font-size: 10px; gap: 0.8em; margin-top: 0px; margin-bottom: 2em; max-width: 24em;  height: 3em; width: 100%; margin-left: auto; margin-right: auto;">
                <div data-role ="fontSizeChangeChrome1" style="display: flex; flex-direction: column; flex: 1 1 0; font-size: 10px; width: 11.5em; height: 4em;">
                    <small data-role ="fontSizeChange1"data-text-key="motDePasse" style="font-size: 9px; color: #888; margin-top: 0px; margin-bottom: 0.22em; padding-top:0; padding-bottom:0; text-align: center;">
                        mot de passe
                    </small>

                    <div data-role ="fontSizeChangeChrome1" style="font-size: 10px; width: 11.5em; height: 4em; box-sizing: border-box; display: inline-block; vertical-align: middle;">
                        <input id="password" data-role ="fontSizeChange1" type="text"  placeholder="Mot de passe" data-text-key="motDePasse" autocapitalize="off" autocorrect="off" spellcheck="false" autocomplete="off" 
                            style="font-size: 10px; width: 100%; height: 100%; text-align: center; box-sizing: border-box; border:0.1em solid #767676; margin: 0; padding: 0; border-radius: 0.3em; outline: none;"
                            onfocus="this.style.border='0.2em solid black';"  onblur="this.style.border='0.1em solid #767676';">
                        </div>    
                </div>

                <div data-role ="fontSizeChangeChrome1" style="display: flex; flex-direction: column; flex: 1 1 0; font-size: 10px; width: 11.5em; height: 4em;">
                    <small data-role ="fontSizeChange1" style="font-size: 9px; color: #888; margin-top: 0px; margin-bottom: 0.22em; padding-top:0; padding-bottom:0; text-align: center;">
                        .
                    </small>

                    <div data-role ="fontSizeChangeChrome1"  style="flex: 1 1 0; font-size: 16px; width: 7.19em; min-height: 1.75em; padding-top: 0.0625em; padding-bottom: 0.0625em; box-sizing: border-box;">
                        <button id="loadDataButton"data-role ="button1"  data-text-key="visualiserArbre" style="font-size: 16px; width: 100%; height: 100%; background-color: #4CAF50; color: white; border: none; border-radius: 0.25em; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 0; padding: 0;">
                            Continuer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="startTitle" style="display: none; position: fixed; top: '80%';  z-index: 1; ">
            <h2 data-role ="fontSizeChange1" style="text-align:center; white-space: nowrap; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding: 0; font-size: 20px; color: white" 
            data-text-key="startTitle">explore tes origines...</h2>
        </div>  
        
    </div>

    <div id="secret-trigger-area" style="opacity:0; position: fixed; left: 10%; top: 70%; width: 80%; height: 20%; z-index: 1; cursor: default;" ></div>
    
    <div id="versionFooter" data-role ="fontSizeChange1"
        style="font-size:10px; position:fixed; bottom:0.3em; left:50%; transform:translateX(-50%);  color:white; text-align:center; z-index:1; pointer-events:none;">
        ¬ÆisAI4U-PD V2.60
    </div>


    <!-- Conteneur de l'arbre -->
    <div id="tree-container" style="display: none;">
        <!-- <button data-role ="button2" id="voiceCommand2Btn" onclick="voiceCommand('full')" style="display: block; position: fixed;  background-color: transparent; font-size: 40px; color: white; border: none; padding: 0px; bottom: 3px; left:50%; transform:translateX(-50%); cursor: pointer; z-index: 10001; ">üéôÔ∏è</button> -->
        <button data-role ="button2" id="voiceCommand2Btn" style="display: block; position: fixed;  background-color: transparent; font-size: 40px; color: white; border: none; padding: 0px; bottom: 3px; left:50%; transform:translateX(-50%); cursor: pointer; z-index: 10001; ">üéôÔ∏è</button>

        <div class="controls">
            <!-- <button data-role ="button2" id="close-tree-button" onclick="returnToLogin()" style="font-size: 32px!important; position: fixed; top: 10px; right: 10px; z-index: 2000; background-color: #f44336; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; min-width: 32px; min-height: 32px; max-width: 32px; max-height: 32px; padding: 0; font-size: 24px; font-weight: bold; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; text-align: center; line-height: 0;">&times; -->
            <button data-role ="fontSizeChangeChrome2" id="close-tree-button" onclick="returnToLogin()" style="font-size: 10px!important; position: fixed; top: 1em; right: 1em; z-index: 2000; background-color: #f44336; color: white; border: none; border-radius: 50%; width: 3.2em; height: 3.2em; min-width: 3.2em; min-height: 3.2em; max-width: 3.2em; max-height: 3.2em; padding: 0; font-weight: bold; cursor: pointer; box-shadow: 0 0.2em 0.5em rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; text-align: center; line-height: 0;">
                <span data-role ="button2" class="wide-span"style="font-size: 32px!important;">&times;</span>
            </button>

            <div data-role ="fontSizeChangeChrome2"  class="controls-row-1" data-original-gap="1.8"  style="font-size: 10px; position: fixed; top: 0.3em; left: 4em; margin-bottom: 0; width: fit-content; padding-left: calc(var(--current-paddindLeft, 1.5) * 1em);  gap: calc(var(--current-gap, 1.8) * 1em);" >
                <!-- gap: 1.8em !important; -->
                <button id="speechToggleBtn" onclick="toggleSpeech()" class="large-button" data-text-key="toggleSpeech" >
                    <span data-role ="button2" class="wide-span" style="font-size: 32px !important;">üîä</span></button>
                <!-- <button class="play-btn" data-role ="fontSizeChangeChrome2" onclick="toggleAnimationPause()" id="animationPauseBtn" data-text-key="toggleAnimationPause" 
                    style="font-size: 10px; border-radius: 0.4em; width: 3em!important; min-width: 3em!important;  max-width: 3em!important; min-height: 3em; max-height: 3em; 
                    box-shadow: inset 0 0.2em 0.3em rgba(255,255,255,0.5),  inset 0 -0.2em 0.3em rgba(0,0,80,0.4),  0 0.1em 0.2em rgba(255,255,255,0.4), 0 0.2em 0.4em rgba(0,0,0,0.35);" >
                    <span data-role ="button2" id="animationPauseBtnSpan" style="font-size: 20px !important; display: inline-block; ">‚ñ∂</span>
                </button> -->


                <!-- <button class="play-btn" data-role ="fontSizeChangeChrome2" onclick="toggleAnimationPause()" id="animationPauseBtn"  -->
                <button class="play-btn" data-role ="fontSizeChangeChrome2"  id="animationPauseBtn" 
                        style="font-size: 10px; border-radius: 0.4em; width: 3em!important; min-width: 3em!important;  max-width: 3em!important; height: 3em!important; min-height: 3em!important; max-height: 3em!important; 
                            display: inline-flex; align-items: center; justify-content: center;  padding: 0; line-height: 1; 
                            box-shadow: inset 0 0.2em 0.3em rgba(255,255,255,0.5), inset 0 -0.2em 0.3em rgba(0,0,80,0.4), 0 0.1em 0.2em rgba(255,255,255,0.4), 0 0.2em 0.4em rgba(0,0,0,0.35);">
                    
                    <!-- <span id="animationPauseBtnSpan" data-role ="button2" style="font-size: 20px !important; display: inline-block; line-height: 1;">‚ñ∂</span> -->
                    <span id="animationPauseBtnSpan" data-role ="button2" style="font-size: 20px;  display: inline-flex; align-items: center; justify-content: center; line-height: 1;">‚ñ∂</span>
                </button>


                <button onclick="openSettingsModal()" id="settingsBtn" class="large-button" data-text-key="openSettingsModal" style="background: transparent; border: none">
                    <span data-role ="button2" style="font-size: 32px!important;">‚öôÔ∏è</span></button>
                <!-- <button id="cloudBtn" onclick="processNamesCloudWithDate({ type: 'prenoms',  startDate: 1500,   endDate: new Date().getFullYear(), scope: 'ancestors' })" data-role ="fontSizeChangeChrome2" class="large-button"  data-text-key="processNamesCloudWithDate" style="font-size:10px; margin-top:-0.2em" >  -->
                <button id="cloudBtn" data-role ="fontSizeChangeChrome2" class="large-button"  data-text-key="processNamesCloudWithDate" style="font-size:10px; margin-top:-0.2em" > 
                    <span data-role ="button2" class="wide-span" style="font-size: 32px !important;">üíñ</span>
                </button>            
                <!-- <input type="text" id="root-person-search" placeholder="üîçracine" inputmode="text" enterkeyhint="next" data-text-key="rootPersonSearch" style=" width: 65px !important;  height: 27px !important; margin-left: -4px !important; " > -->


                <div data-role ="fontSizeChangeChrome2" id="root-person-search-div" style="font-size: 10px; width: 6.5em!important; min-width: 6.5em!important; max-width: 6.5em!important;  height: 2.7em; min-height: 2.7em!important; margin-left: -0.4em; ">
                    <input data-role ="fontSizeChange2" type="text" id="root-person-search" placeholder="üîçracine" inputmode="text" enterkeyhint="next" data-text-key="rootPersonSearch" style="font-size: 15px; width: 100%; height: 100%; box-sizing: border-box; display: block; border: 0.1em solid #ccc; border-radius: 0.4em;">
                </div> 

                <select id="root-person-results" data-text-key="rootPersonResults"  >
                    <option value="">Select</option>
                </select>
                <!-- <button data-role ="fontSizeChangeChrome2"  id="heatMapBtn" onclick="displayHeatMap()" class="large-button"  data-text-key="heatMap" style="font-size: 10px !important;" >  -->
                <button data-role ="fontSizeChangeChrome2"  id="heatMapBtn"  class="large-button"  data-text-key="heatMap" style="font-size: 10px !important;" > 
                    <span data-role ="button2" class="wide-span" style="font-size: 32px !important;">üåç</span>
                </button> 
                <button id="radarBtn" onclick="toggleTreeRadar()" class="large-button"  data-text-key="radar" > 
                    <span data-role ="button2" class="wide-span" style="font-size: 32px !important;">üéØ</span>
                </button> 
                <!-- <button id="statsBtn" onclick="statsModal()"  data-text-key="stats" >  -->
                <button id="statsBtn" data-text-key="stats" > 
                    <span data-role ="button2" class="wide-span" style="font-size: 32px !important;">üìä</span>
                </button> 
            </div>
            
            <div data-role ="fontSizeChangeChrome2" class="controls-row-2" style="font: size 10px !important; position: fixed; top: 3.1em; left: 0.7em; gap: 0.3em!important; width: fit-content;">                  
                <label data-role ="fontSizeChange2" id="generationsLabel" for="generations" data-text-key="nbreGene" style="font-size: 12px !important;">nbre<br>g√©n√©</label>
                <!-- Le s√©lecteur sera remplac√© dynamiquement par JavaScript -->
                <!-- <select id="generations" onchange="updateGenerations(this.value)" data-text-key="updateGenerations";"> -->
                <select id="generations"  data-text-key="updateGenerations";>
                </select>
                    <!-- Le s√©lecteur sera remplac√© dynamiquement par JavaScript -->
                    <select id="treeMode" onchange="updateTreeMode(this.value)" data-text-key="treeMode"  style="border: 1px solid black; background-color: rgba(255, 255, 255, 0.8); margin: 0; padding: 0 2px;">
                        <option value="ancestors" data-text-key="treeModeAncestors" selected>Asc.</option>
                        <option value="descendants"  data-text-key="treeModeDescendants">Desc.</option>
                        <option value="both" data-text-key="treeModeBoth">A+D</option>
                    </select>
                </select>
            </div> 
            
        </div>

        <svg id="tree-svg"></svg>
        <div id="animation-map-container" style="position: fixed; bottom: 20px; left: 20px; width: 300px; height: 200px; z-index: 1000; background-color: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <div id="animation-map" style="width: 100%; height: 100%; border-radius: 10px;"></div>
        </div>
 
    </div>

    <!-- Fen√™tre modale pour les param√®tres -->
    <div id="settings-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Param√®tres</h2>
                <span class="modal-close" onclick="closeSettingsModal()">&times;</span>
            </div>
            <div id="settings-content">
                <div class="settings-section">
                    <h3>Animation des Anc√™tres</h3>
                    <label for="targetAncestorId">ID de l'Anc√™tre Cible :</label>
                    <input 
                        type="text" 
                        id="targetAncestorId" 
                        value="@I741@" 
                        placeholder="Entrez l'ID de l'anc√™tre"
                    >
                    <button onclick="saveTargetAncestorId()">Enregistrer</button>
                </div>
                
                <!-- Nouveau bloc pour le module "prenoms" -->
                <div class="settings-section">
                    <h3>Nombre de Pr√©noms</h3>
                    <label for="prenoms">nbre<br>pr√©nom</label>
                    <!-- <select id="prenoms" onchange="updatePrenoms(this.value)" data-text-key="prenoms"> -->
                    <select id="prenoms"  data-text-key="prenoms">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </div>

                <!-- Section pour le g√©ocodage -->
                <div class="settings-section">
                    <h3>G√©ocodage Local</h3>
                    <div style="margin-bottom: 10px;">
                        <label for="maxLocations">Nombre max. de lieux √† traiter :</label>
                        <input 
                            type="number" 
                            id="maxLocations" 
                            value="10" 
                            min="1"
                            style="width: 80px;"
                        >
                        <span style="font-size: 0.8em; color: #666;">(0 = tous)</span>
                    </div>
                    <!-- <button id="generateGeocodeFileBtn" onclick="generateGeocodeFile()">G√©n√©rer fichier geolocalisation.json</button> -->
                    <button id="generateGeocodeFileBtn" >G√©n√©rer fichier geolocalisation.json</button>

                    <div id="geocoding-progress" style="margin-top: 10px; display: none;">
                        <div id="geocoding-status"></div>
                        <progress id="geocoding-bar" value="0" max="100" style="width: 100%;"></progress>
                    </div>
                    <select id="geocoding-results" size="10" style="width: 100%; margin-top: 10px; display: none;">
                        <option>R√©sultats appara√Ætront ici</option>
                    </select>
                </div>
                <div class="settings-section">
                    <h3>G√©n√©rer les tuiles/map en local</h3>
                    <button onclick="generateLocalMaps()">G√©n√©rer les tuiles/maps</button>
                </div>


            </div>
        </div>
    </div>

    
<!-- fen√™tre toast pour faire un tooltip -->
<!-- <div id="mobile-toast" style="position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px; z-index: 1500; display: none;">Message</div> -->
<div id="mobile-toast" style="position: fixed; top: auto; bottom: 10%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px; z-index: 1500; display: none;">Message</div>


</body>
</html>