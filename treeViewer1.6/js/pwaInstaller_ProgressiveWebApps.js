// // Gestionnaire d'installation PWA

// class PWAInstaller {
//     constructor() {
//         this.deferredPrompt = null;
//         this.installButton = null;
//         this.isInitialized = false;
        
//         // Initialiser quand le DOM est pr√™t
//         if (document.readyState === 'loading') {
//             document.addEventListener('DOMContentLoaded', () => this.init());
//         } else {
//             this.init();
//         }
//     }

//     init() {
//         if (this.isInitialized) return;
        
//         console.log('[PWA Installer] Initialisation...');
        
//         // √âcouter l'√©v√©nement d'installation
//         this.setupInstallPromptListener();
        
//         // √âcouter l'√©v√©nement d'installation r√©ussie
//         this.setupInstallSuccessListener();
        
//         // Cr√©er le bouton d'installation
//         this.createInstallButton();
        
//         // V√©rifier si on peut d√©j√† afficher le bouton
//         this.checkInstallAvailability();
        
//         this.isInitialized = true;
//         console.log('[PWA Installer] Initialis√© avec succ√®s');
//     }

//     setupInstallPromptListener() {
//         window.addEventListener('beforeinstallprompt', (e) => {
//             console.log('[PWA Installer] beforeinstallprompt d√©clench√©');
            
//             // Emp√™cher l'affichage automatique
//             e.preventDefault();
            
//             // Stocker l'√©v√©nement
//             this.deferredPrompt = e;
            
//             // Afficher le bouton
//             this.showInstallButton();
//         });
//     }

//     setupInstallSuccessListener() {
//         window.addEventListener('appinstalled', (evt) => {
//             console.log('[PWA Installer] Application install√©e avec succ√®s');
//             this.hideInstallButton();
//             this.deferredPrompt = null;
//         });
//     }

//     createInstallButton() {
//         // V√©rifier si le bouton existe d√©j√†
//         if (this.installButton) return;

//         // Trouver le conteneur dans la modal gedcom
//         const modalContent = document.querySelector('#gedcom-modal div[style*="padding: 20px"]');
//         if (!modalContent) {
//             console.warn('[PWA Installer] Conteneur de modal non trouv√©, tentative diff√©r√©e...');
//             // R√©essayer plus tard
//             setTimeout(() => this.createInstallButton(), 1000);
//             return;
//         }

//         // Cr√©er le bouton d'installation
//         this.installButton = document.createElement('button');
//         this.installButton.id = 'install-app-btn';
//         this.installButton.innerHTML = 'üì± Installer l\'application';
//         this.installButton.style.cssText = `
//             background-color: #ff8c42; 
//             color: white; 
//             border: none; 
//             padding: 10px; 
//             width: 100%; 
//             max-width: 240px; 
//             border-radius: 4px; 
//             cursor: pointer; 
//             font-weight: bold; 
//             margin: 0 auto 10px auto;
//             display: none;
//             box-sizing: border-box;
//         `;
        
//         // Ajouter l'attribut pour la traduction
//         this.installButton.setAttribute('data-text-key', 'installerApp');
        
//         // Ajouter l'√©v√©nement click
//         this.installButton.addEventListener('click', () => this.installApp());
        
//         // Ins√©rer le bouton avant le bouton "Activer les logs"
//         const debugBtn = document.getElementById('activateDebugLogsBtn');
//         if (debugBtn) {
//             debugBtn.parentNode.insertBefore(this.installButton, debugBtn);
//         } else {
//             // Fallback : ajouter √† la fin du conteneur
//             modalContent.appendChild(this.installButton);
//         }
        
//         console.log('[PWA Installer] Bouton d\'installation cr√©√©');
//     }

//     showInstallButton() {
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//             console.log('[PWA Installer] Bouton d\'installation affich√©');
//         }
//     }

//     hideInstallButton() {
//         if (this.installButton) {
//             this.installButton.style.display = 'none';
//             console.log('[PWA Installer] Bouton d\'installation masqu√©');
//         }
//     }

//     async installApp() {
//         console.log('[PWA Installer] Tentative d\'installation...');
        
//         if (this.deferredPrompt) {
//             try {
//                 // Afficher la popup d'installation
//                 this.deferredPrompt.prompt();
                
//                 // Attendre le choix de l'utilisateur
//                 const choiceResult = await this.deferredPrompt.userChoice;
                
//                 if (choiceResult.outcome === 'accepted') {
//                     console.log('[PWA Installer] Installation accept√©e par l\'utilisateur');
//                     this.hideInstallButton();
//                 } else {
//                     console.log('[PWA Installer] Installation refus√©e par l\'utilisateur');
//                 }
                
//                 this.deferredPrompt = null;
//             } catch (error) {
//                 console.error('[PWA Installer] Erreur lors de l\'installation:', error);
//                 this.showManualInstallInstructions();
//             }
//         } else {
//             // Pas d'√©v√©nement beforeinstallprompt disponible
//             this.showManualInstallInstructions();
//         }
//     }

//     showManualInstallInstructions() {
//         const userAgent = navigator.userAgent.toLowerCase();
//         let instructions = 'Pour installer cette application :\n\n';
        
//         if (userAgent.includes('chrome') && userAgent.includes('mobile')) {
//             instructions += '1. Appuyez sur le menu du navigateur (‚ãÆ)\n' +
//                           '2. S√©lectionnez "Ajouter √† l\'√©cran d\'accueil"\n' +
//                           '3. Confirmez l\'installation';
//         } else if (userAgent.includes('safari') && userAgent.includes('mobile')) {
//             instructions += '1. Appuyez sur le bouton Partager\n' +
//                           '2. S√©lectionnez "Sur l\'√©cran d\'accueil"\n' +
//                           '3. Confirmez l\'ajout';
//         } else if (userAgent.includes('edge')) {
//             instructions += '1. Appuyez sur le menu (‚ãØ)\n' +
//                           '2. S√©lectionnez "Applications"\n' +
//                           '3. Choisissez "Installer cette application"';
//         } else {
//             instructions += '1. Cherchez l\'option "Ajouter √† l\'√©cran d\'accueil"\n' +
//                           '   ou "Installer l\'application" dans le menu\n' +
//                           '2. Confirmez l\'installation';
//         }
        
//         // Utiliser une modal plus jolie au lieu d'alert
//         this.showInstallModal(instructions);
//     }

//     showInstallModal(instructions) {
//         // Cr√©er une modal temporaire pour les instructions
//         const modal = document.createElement('div');
//         modal.style.cssText = `
//             position: fixed;
//             top: 0;
//             left: 0;
//             width: 100%;
//             height: 100%;
//             background-color: rgba(0,0,0,0.5);
//             z-index: 2000;
//             display: flex;
//             justify-content: center;
//             align-items: center;
//         `;
        
//         const modalContent = document.createElement('div');
//         modalContent.style.cssText = `
//             background-color: white;
//             padding: 20px;
//             border-radius: 10px;
//             max-width: 90%;
//             width: 300px;
//             box-shadow: 0 4px 6px rgba(0,0,0,0.1);
//             text-align: center;
//         `;
        
//         modalContent.innerHTML = `
//             <h3 style="margin-top: 0; color: #ff8c42;">üì± Installation manuelle</h3>
//             <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
//             <button id="close-install-modal" style="
//                 background-color: #ff8c42;
//                 color: white;
//                 border: none;
//                 padding: 10px 20px;
//                 border-radius: 4px;
//                 cursor: pointer;
//                 font-weight: bold;
//                 margin-top: 10px;
//             ">Compris</button>
//         `;
        
//         modal.appendChild(modalContent);
//         document.body.appendChild(modal);
        
//         // Fermer la modal
//         const closeBtn = modal.querySelector('#close-install-modal');
//         const closeModal = () => {
//             document.body.removeChild(modal);
//         };
        
//         closeBtn.addEventListener('click', closeModal);
//         modal.addEventListener('click', (e) => {
//             if (e.target === modal) closeModal();
//         });
        
//         // Auto-fermeture apr√®s 10 secondes
//         setTimeout(closeModal, 10000);
//     }

//     isAppInstalled() {
//         // V√©rifier si l'app est lanc√©e en mode standalone
//         return window.matchMedia('(display-mode: standalone)').matches ||
//                window.navigator.standalone === true;
//     }

//     checkInstallAvailability() {
//         // Si l'app est d√©j√† install√©e, pas besoin du bouton
//         if (this.isAppInstalled()) {
//             console.log('[PWA Installer] Application d√©j√† install√©e');
//             return;
//         }

//         // Sur certains navigateurs, l'√©v√©nement beforeinstallprompt ne se d√©clenche pas
//         // Dans ce cas, on affiche le bouton avec des instructions manuelles apr√®s un d√©lai
//         setTimeout(() => {
//             if (!this.deferredPrompt && this.installButton && !this.isAppInstalled()) {
//                 this.installButton.style.display = 'block';
//                 this.installButton.innerHTML = 'üì± Installer (manuel)';
//                 console.log('[PWA Installer] Bouton manuel affich√© (pas d\'√©v√©nement beforeinstallprompt)');
//             }
//         }, 3000);
//     }

//     // M√©thode publique pour afficher les instructions manuelles (utile pour debug/test)
//     showManualInstructions() {
//         this.showManualInstallInstructions();
//     }

//     // M√©thode publique pour v√©rifier l'√©tat
//     getStatus() {
//         return {
//             isInitialized: this.isInitialized,
//             hasPrompt: !!this.deferredPrompt,
//             isInstalled: this.isAppInstalled(),
//             buttonVisible: this.installButton ? this.installButton.style.display !== 'none' : false
//         };
//     }
// }

// // Cr√©er une instance globale
// window.pwaInstaller = new PWAInstaller();

// // Exposer quelques m√©thodes utiles pour le debug
// window.forceInstallPrompt = () => window.pwaInstaller.forceShowInstallButton();
// window.getPWAStatus = () => window.pwaInstaller.getStatus();
// window.showInstallInstructions = () => window.pwaInstaller.showManualInstructions();

// // M√©thode publique pour forcer l'affichage (utile pour le debug)
// PWAInstaller.prototype.forceShowInstallButton = function() {
//     if (!this.installButton) {
//         this.createInstallButton();
//     }
    
//     if (this.installButton) {
//         this.installButton.style.display = 'block';
//         console.log('[PWA Installer] Bouton d\'installation forc√©');
//     }
// };

// // Export pour les modules (optionnel)
// if (typeof module !== 'undefined' && module.exports) {
//     module.exports = PWAInstaller;
// }


























// // js/pwaInstaller.js
// // Gestionnaire d'installation PWA

// class PWAInstaller {
//     constructor() {
//         this.deferredPrompt = null;
//         this.installButton = null;
//         this.isInitialized = false;
        
//         // Initialiser quand le DOM est pr√™t
//         if (document.readyState === 'loading') {
//             document.addEventListener('DOMContentLoaded', () => this.init());
//         } else {
//             this.init();
//         }
//     }

//     init() {
//         if (this.isInitialized) return;
        
//         console.log('[PWA Installer] Initialisation...');
        
//         // √âcouter l'√©v√©nement d'installation
//         this.setupInstallPromptListener();
        
//         // √âcouter l'√©v√©nement d'installation r√©ussie
//         this.setupInstallSuccessListener();
        
//         // Cr√©er le bouton d'installation
//         this.createInstallButton();
        
//         // V√©rifier si on peut d√©j√† afficher le bouton
//         this.checkInstallAvailability();
        
//         this.isInitialized = true;
//         console.log('[PWA Installer] Initialis√© avec succ√®s');
//     }

//     setupInstallPromptListener() {
//         window.addEventListener('beforeinstallprompt', (e) => {
//             console.log('[PWA Installer] beforeinstallprompt d√©clench√©');
            
//             // Emp√™cher l'affichage automatique
//             e.preventDefault();
            
//             // Stocker l'√©v√©nement
//             this.deferredPrompt = e;
            
//             // Afficher le bouton
//             this.showInstallButton();
//         });
//     }

//     setupInstallSuccessListener() {
//         window.addEventListener('appinstalled', (evt) => {
//             console.log('[PWA Installer] Application install√©e avec succ√®s');
//             this.updateButtonForInstalledState();
//             this.deferredPrompt = null;
//         });
//     }

//     createInstallButton() {
//         // V√©rifier si le bouton existe d√©j√†
//         if (this.installButton) return;

//         // Trouver le conteneur dans la modal gedcom
//         const modalContent = document.querySelector('#gedcom-modal div[style*="padding: 20px"]');
//         if (!modalContent) {
//             console.warn('[PWA Installer] Conteneur de modal non trouv√©, tentative diff√©r√©e...');
//             // R√©essayer plus tard
//             setTimeout(() => this.createInstallButton(), 1000);
//             return;
//         }

//         // Cr√©er le bouton d'installation
//         this.installButton = document.createElement('button');
//         this.installButton.id = 'install-app-btn';
//         this.updateButtonContent();
//         this.installButton.style.cssText = `
//             background-color: #ff8c42; 
//             color: white; 
//             border: none; 
//             padding: 10px; 
//             width: 100%; 
//             max-width: 240px; 
//             border-radius: 4px; 
//             cursor: pointer; 
//             font-weight: bold; 
//             margin: 0 auto 10px auto;
//             display: none;
//             box-sizing: border-box;
//         `;
        
//         // Ajouter l'√©v√©nement click
//         this.installButton.addEventListener('click', () => {
//             if (this.isAppInstalled()) {
//                 this.uninstallApp();
//             } else {
//                 this.installApp();
//             }
//         });
        
//         // Ins√©rer le bouton avant le bouton "Activer les logs"
//         const debugBtn = document.getElementById('activateDebugLogsBtn');
//         if (debugBtn) {
//             debugBtn.parentNode.insertBefore(this.installButton, debugBtn);
//         } else {
//             // Fallback : ajouter √† la fin du conteneur
//             modalContent.appendChild(this.installButton);
//         }
        
//         console.log('[PWA Installer] Bouton d\'installation/d√©sinstallation cr√©√©');
//     }

//     updateButtonContent() {
//         if (!this.installButton) return;
        
//         if (this.isAppInstalled()) {
//             this.installButton.innerHTML = 'üì± D√©sinstaller l\'application';
//             this.installButton.setAttribute('data-text-key', 'desinstallerApp');
//         } else {
//             this.installButton.innerHTML = 'üì± Installer l\'application';
//             this.installButton.setAttribute('data-text-key', 'installerApp');
//         }
//     }

//     updateButtonForInstalledState() {
//         this.updateButtonContent();
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//         }
//     }

//     showInstallButton() {
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//             this.updateButtonContent();
//             console.log('[PWA Installer] Bouton d\'installation affich√©');
//         }
//     }

//     hideInstallButton() {
//         if (this.installButton) {
//             this.installButton.style.display = 'none';
//             console.log('[PWA Installer] Bouton d\'installation masqu√©');
//         }
//     }

//     async installApp() {
//         console.log('[PWA Installer] Tentative d\'installation...');
        
//         if (this.deferredPrompt) {
//             try {
//                 // Afficher la popup d'installation
//                 this.deferredPrompt.prompt();
                
//                 // Attendre le choix de l'utilisateur
//                 const choiceResult = await this.deferredPrompt.userChoice;
                
//                 if (choiceResult.outcome === 'accepted') {
//                     console.log('[PWA Installer] Installation accept√©e par l\'utilisateur');
//                     // Le bouton sera mis √† jour par l'√©v√©nement 'appinstalled'
//                 } else {
//                     console.log('[PWA Installer] Installation refus√©e par l\'utilisateur');
//                 }
                
//                 this.deferredPrompt = null;
//             } catch (error) {
//                 console.error('[PWA Installer] Erreur lors de l\'installation:', error);
//                 this.showManualInstallInstructions();
//             }
//         } else {
//             // Pas d'√©v√©nement beforeinstallprompt disponible
//             this.showManualInstallInstructions();
//         }
//     }

//     async uninstallApp() {
//         console.log('[PWA Installer] Tentative de d√©sinstallation...');
        
//         // Instructions de d√©sinstallation
//         const userAgent = navigator.userAgent.toLowerCase();
//         let instructions = 'Pour d√©sinstaller cette application :\n\n';
        
//         if (userAgent.includes('chrome') && userAgent.includes('mobile')) {
//             instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'app\n' +
//                           '2. S√©lectionnez "D√©sinstaller" ou glissez vers "Supprimer"\n' +
//                           '3. Confirmez la suppression';
//         } else if (userAgent.includes('safari') && userAgent.includes('mobile')) {
//             instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'app\n' +
//                           '2. Appuyez sur le "X" qui appara√Æt\n' +
//                           '3. Confirmez la suppression';
//         } else {
//             instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'application\n' +
//                           '2. S√©lectionnez "D√©sinstaller" ou "Supprimer"\n' +
//                           '3. Confirmez la suppression\n\n' +
//                           'Ou allez dans les param√®tres du navigateur :\n' +
//                           '‚Ä¢ Applications install√©es\n' +
//                           '‚Ä¢ Trouvez cette app et d√©sinstallez-la';
//         }
        
//         this.showUninstallModal(instructions);
//     }

//     showManualInstallInstructions() {
//         const userAgent = navigator.userAgent.toLowerCase();
//         let instructions = 'Pour installer cette application :\n\n';
        
//         if (userAgent.includes('chrome') && userAgent.includes('mobile')) {
//             instructions += '1. Appuyez sur le menu du navigateur (‚ãÆ)\n' +
//                           '2. S√©lectionnez "Ajouter √† l\'√©cran d\'accueil"\n' +
//                           '3. Confirmez l\'installation';
//         } else if (userAgent.includes('safari') && userAgent.includes('mobile')) {
//             instructions += '1. Appuyez sur le bouton Partager\n' +
//                           '2. S√©lectionnez "Sur l\'√©cran d\'accueil"\n' +
//                           '3. Confirmez l\'ajout';
//         } else if (userAgent.includes('edge')) {
//             instructions += '1. Appuyez sur le menu (‚ãØ)\n' +
//                           '2. S√©lectionnez "Applications"\n' +
//                           '3. Choisissez "Installer cette application"';
//         } else {
//             instructions += '1. Cherchez l\'option "Ajouter √† l\'√©cran d\'accueil"\n' +
//                           '   ou "Installer l\'application" dans le menu\n' +
//                           '2. Confirmez l\'installation';
//         }
        
//         // Utiliser une modal plus jolie au lieu d'alert
//         this.showInstallModal(instructions);
//     }

//     showInstallModal(instructions) {
//         // Cr√©er une modal temporaire pour les instructions
//         const modal = document.createElement('div');
//         modal.style.cssText = `
//             position: fixed;
//             top: 0;
//             left: 0;
//             width: 100%;
//             height: 100%;
//             background-color: rgba(0,0,0,0.5);
//             z-index: 2000;
//             display: flex;
//             justify-content: center;
//             align-items: center;
//         `;
        
//         const modalContent = document.createElement('div');
//         modalContent.style.cssText = `
//             background-color: white;
//             padding: 20px;
//             border-radius: 10px;
//             max-width: 90%;
//             width: 300px;
//             box-shadow: 0 4px 6px rgba(0,0,0,0.1);
//             text-align: center;
//         `;
        
//         modalContent.innerHTML = `
//             <h3 style="margin-top: 0; color: #ff8c42;">üì± Installation manuelle</h3>
//             <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
//             <button id="close-install-modal" style="
//                 background-color: #ff8c42;
//                 color: white;
//                 border: none;
//                 padding: 10px 20px;
//                 border-radius: 4px;
//                 cursor: pointer;
//                 font-weight: bold;
//                 margin-top: 10px;
//             ">Compris</button>
//         `;
        
//         modal.appendChild(modalContent);
//         document.body.appendChild(modal);
        
//         // Fermer la modal
//         const closeBtn = modal.querySelector('#close-install-modal');
//         const closeModal = () => {
//             document.body.removeChild(modal);
//         };
        
//         closeBtn.addEventListener('click', closeModal);
//         modal.addEventListener('click', (e) => {
//             if (e.target === modal) closeModal();
//         });
        
//         // Auto-fermeture apr√®s 10 secondes
//         setTimeout(closeModal, 10000);
//     }

//     showUninstallModal(instructions) {
//         // Cr√©er une modal pour les instructions de d√©sinstallation
//         const modal = document.createElement('div');
//         modal.style.cssText = `
//             position: fixed;
//             top: 0;
//             left: 0;
//             width: 100%;
//             height: 100%;
//             background-color: rgba(0,0,0,0.5);
//             z-index: 2000;
//             display: flex;
//             justify-content: center;
//             align-items: center;
//         `;
        
//         const modalContent = document.createElement('div');
//         modalContent.style.cssText = `
//             background-color: white;
//             padding: 20px;
//             border-radius: 10px;
//             max-width: 90%;
//             width: 300px;
//             box-shadow: 0 4px 6px rgba(0,0,0,0.1);
//             text-align: center;
//         `;
        
//         modalContent.innerHTML = `
//             <h3 style="margin-top: 0; color: #ff4444;">üóëÔ∏è D√©sinstallation</h3>
//             <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
//             <button id="close-uninstall-modal" style="
//                 background-color: #ff4444;
//                 color: white;
//                 border: none;
//                 padding: 10px 20px;
//                 border-radius: 4px;
//                 cursor: pointer;
//                 font-weight: bold;
//                 margin-top: 10px;
//             ">Compris</button>
//         `;
        
//         modal.appendChild(modalContent);
//         document.body.appendChild(modal);
        
//         // Fermer la modal
//         const closeBtn = modal.querySelector('#close-uninstall-modal');
//         const closeModal = () => {
//             document.body.removeChild(modal);
//             // Apr√®s fermeture, remettre le bouton en mode installation si pas install√©
//             setTimeout(() => {
//                 if (!this.isAppInstalled()) {
//                     this.updateButtonContent();
//                 }
//             }, 1000);
//         };
        
//         closeBtn.addEventListener('click', closeModal);
//         modal.addEventListener('click', (e) => {
//             if (e.target === modal) closeModal();
//         });
        
//         // Auto-fermeture apr√®s 15 secondes
//         setTimeout(closeModal, 15000);
//     }

//     isAppInstalled() {
//         // V√©rifier si l'app est lanc√©e en mode standalone
//         return window.matchMedia('(display-mode: standalone)').matches ||
//                window.navigator.standalone === true;
//     }

//     checkInstallAvailability() {
//         // Mettre √† jour le contenu du bouton selon l'√©tat
//         this.updateButtonContent();
        
//         // Toujours afficher le bouton
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//         }
        
//         // Si l'app est d√©j√† install√©e, on a le bouton de d√©sinstallation
//         if (this.isAppInstalled()) {
//             console.log('[PWA Installer] Application d√©j√† install√©e - bouton de d√©sinstallation disponible');
//             return;
//         }

//         // Si pas install√©e, attendre un peu pour voir si l'√©v√©nement se d√©clenche
//         setTimeout(() => {
//             if (!this.deferredPrompt && this.installButton && !this.isAppInstalled()) {
//                 this.installButton.innerHTML = 'üì± Installer (manuel)';
//                 console.log('[PWA Installer] Bouton manuel affich√© (pas d\'√©v√©nement beforeinstallprompt)');
//             }
//         }, 3000);
//     }

//     // M√©thode publique pour afficher les instructions manuelles (utile pour debug/test)
//     showManualInstructions() {
//         this.showManualInstallInstructions();
//     }

//     // M√©thode publique pour forcer l'affichage (utile pour le debug)
//     forceShowInstallButton() {
//         if (!this.installButton) {
//             this.createInstallButton();
//         }
        
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//             this.updateButtonContent();
//             console.log('[PWA Installer] Bouton d\'installation forc√©');
//         }
//     }

//     // M√©thode publique pour v√©rifier l'√©tat
//     getStatus() {
//         return {
//             isInitialized: this.isInitialized,
//             hasPrompt: !!this.deferredPrompt,
//             isInstalled: this.isAppInstalled(),
//             buttonVisible: this.installButton ? this.installButton.style.display !== 'none' : false
//         };
//     }
// }

// // Cr√©er une instance globale
// window.pwaInstaller = new PWAInstaller();

// // Exposer quelques m√©thodes utiles pour le debug
// window.forceInstallPrompt = () => window.pwaInstaller.forceShowInstallButton();
// window.getPWAStatus = () => window.pwaInstaller.getStatus();
// window.showInstallInstructions = () => window.pwaInstaller.showManualInstructions();

// // Export pour les modules (optionnel)
// if (typeof module !== 'undefined' && module.exports) {
//     module.exports = PWAInstaller;
// }


























// // js/pwaInstaller.js
// // Gestionnaire d'installation PWA

// class PWAInstaller {
//     constructor() {
//         this.deferredPrompt = null;
//         this.installButton = null;
//         this.isInitialized = false;
        
//         // Initialiser quand le DOM est pr√™t
//         if (document.readyState === 'loading') {
//             document.addEventListener('DOMContentLoaded', () => this.init());
//         } else {
//             this.init();
//         }
//     }

//     init() {
//         if (this.isInitialized) return;
        
//         console.log('[PWA Installer] Initialisation...');
        
//         // √âcouter l'√©v√©nement d'installation
//         this.setupInstallPromptListener();
        
//         // √âcouter l'√©v√©nement d'installation r√©ussie
//         this.setupInstallSuccessListener();
        
//         // Cr√©er le bouton d'installation
//         this.createInstallButton();
        
//         // V√©rifier si on peut d√©j√† afficher le bouton
//         this.checkInstallAvailability();
        
//         this.isInitialized = true;
//         console.log('[PWA Installer] Initialis√© avec succ√®s');
//     }

//     setupInstallPromptListener() {
//         window.addEventListener('beforeinstallprompt', (e) => {
//             console.log('[PWA Installer] beforeinstallprompt d√©clench√©');
            
//             // Emp√™cher l'affichage automatique
//             e.preventDefault();
            
//             // Stocker l'√©v√©nement
//             this.deferredPrompt = e;
            
//             // Afficher le bouton
//             this.showInstallButton();
//         });
//     }

//     setupInstallSuccessListener() {
//         window.addEventListener('appinstalled', (evt) => {
//             console.log('[PWA Installer] Application install√©e avec succ√®s');
//             // Marquer comme install√©e dans le localStorage
//             localStorage.setItem('pwa-installed', 'true');
//             this.updateButtonForInstalledState();
//             this.deferredPrompt = null;
//         });
//     }

//     createInstallButton() {
//         // V√©rifier si le bouton existe d√©j√†
//         if (this.installButton) return;

//         // Trouver le conteneur dans la modal gedcom
//         const modalContent = document.querySelector('#gedcom-modal div[style*="padding: 20px"]');
//         if (!modalContent) {
//             console.warn('[PWA Installer] Conteneur de modal non trouv√©, tentative diff√©r√©e...');
//             // R√©essayer plus tard
//             setTimeout(() => this.createInstallButton(), 1000);
//             return;
//         }

//         // Cr√©er le bouton d'installation
//         this.installButton = document.createElement('button');
//         this.installButton.id = 'install-app-btn';
//         this.updateButtonContent();
//         this.installButton.style.cssText = `
//             background-color: #ff8c42; 
//             color: white; 
//             border: none; 
//             padding: 10px; 
//             width: 100%; 
//             max-width: 240px; 
//             border-radius: 4px; 
//             cursor: pointer; 
//             font-weight: bold; 
//             margin: 0 auto 10px auto;
//             display: none;
//             box-sizing: border-box;
//         `;
        
//         // Ajouter l'√©v√©nement click
//         this.installButton.addEventListener('click', () => {
//             if (this.isAppInstalled()) {
//                 this.uninstallApp();
//             } else {
//                 this.installApp();
//             }
//         });
        
//         // Ins√©rer le bouton avant le bouton "Activer les logs"
//         const debugBtn = document.getElementById('activateDebugLogsBtn');
//         if (debugBtn) {
//             debugBtn.parentNode.insertBefore(this.installButton, debugBtn);
//         } else {
//             // Fallback : ajouter √† la fin du conteneur
//             modalContent.appendChild(this.installButton);
//         }
        
//         console.log('[PWA Installer] Bouton d\'installation/d√©sinstallation cr√©√©');
//     }

//     updateButtonContent() {
//         if (!this.installButton) return;
        
//         if (this.isAppInstalled()) {
//             this.installButton.innerHTML = 'üì± D√©sinstaller l\'application';
//             this.installButton.setAttribute('data-text-key', 'desinstallerApp');
//         } else {
//             this.installButton.innerHTML = 'üì± Installer l\'application';
//             this.installButton.setAttribute('data-text-key', 'installerApp');
//         }
//     }

//     updateButtonForInstalledState() {
//         this.updateButtonContent();
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//         }
//     }

//     showInstallButton() {
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//             this.updateButtonContent();
//             console.log('[PWA Installer] Bouton d\'installation affich√©');
//         }
//     }

//     hideInstallButton() {
//         if (this.installButton) {
//             this.installButton.style.display = 'none';
//             console.log('[PWA Installer] Bouton d\'installation masqu√©');
//         }
//     }

//     async installApp() {
//         console.log('[PWA Installer] Tentative d\'installation...');
        
//         if (this.deferredPrompt) {
//             try {
//                 // Afficher la popup d'installation
//                 this.deferredPrompt.prompt();
                
//                 // Attendre le choix de l'utilisateur
//                 const choiceResult = await this.deferredPrompt.userChoice;
                
//                 if (choiceResult.outcome === 'accepted') {
//                     console.log('[PWA Installer] Installation accept√©e par l\'utilisateur');
//                     // Marquer comme install√©e
//                     localStorage.setItem('pwa-installed', 'true');
//                     // Le bouton sera mis √† jour par l'√©v√©nement 'appinstalled' ou ici
//                     setTimeout(() => this.updateButtonForInstalledState(), 1000);
//                 } else {
//                     console.log('[PWA Installer] Installation refus√©e par l\'utilisateur');
//                 }
                
//                 this.deferredPrompt = null;
//             } catch (error) {
//                 console.error('[PWA Installer] Erreur lors de l\'installation:', error);
//                 this.showManualInstallInstructions();
//             }
//         } else {
//             // Pas d'√©v√©nement beforeinstallprompt disponible
//             this.showManualInstallInstructions();
//         }
//     }

//     async uninstallApp() {
//         console.log('[PWA Installer] Tentative de d√©sinstallation...');
        
//         // Instructions de d√©sinstallation
//         const userAgent = navigator.userAgent.toLowerCase();
//         let instructions = 'Pour d√©sinstaller cette application :\n\n';
        
//         if (userAgent.includes('chrome') && userAgent.includes('mobile')) {
//             instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'app\n' +
//                           '2. S√©lectionnez "D√©sinstaller" ou glissez vers "Supprimer"\n' +
//                           '3. Confirmez la suppression';
//         } else if (userAgent.includes('safari') && userAgent.includes('mobile')) {
//             instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'app\n' +
//                           '2. Appuyez sur le "X" qui appara√Æt\n' +
//                           '3. Confirmez la suppression';
//         } else {
//             instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'application\n' +
//                           '2. S√©lectionnez "D√©sinstaller" ou "Supprimer"\n' +
//                           '3. Confirmez la suppression\n\n' +
//                           'Ou allez dans les param√®tres du navigateur :\n' +
//                           '‚Ä¢ Applications install√©es\n' +
//                           '‚Ä¢ Trouvez cette app et d√©sinstallez-la';
//         }
        
//         this.showUninstallModal(instructions);
//     }

//     showManualInstallInstructions() {
//         const userAgent = navigator.userAgent.toLowerCase();
//         let instructions = 'Pour installer cette application :\n\n';
        
//         if (userAgent.includes('chrome') && userAgent.includes('mobile')) {
//             instructions += '1. Appuyez sur le menu du navigateur (‚ãÆ)\n' +
//                           '2. S√©lectionnez "Ajouter √† l\'√©cran d\'accueil"\n' +
//                           '3. Confirmez l\'installation';
//         } else if (userAgent.includes('safari') && userAgent.includes('mobile')) {
//             instructions += '1. Appuyez sur le bouton Partager\n' +
//                           '2. S√©lectionnez "Sur l\'√©cran d\'accueil"\n' +
//                           '3. Confirmez l\'ajout';
//         } else if (userAgent.includes('edge')) {
//             instructions += '1. Appuyez sur le menu (‚ãØ)\n' +
//                           '2. S√©lectionnez "Applications"\n' +
//                           '3. Choisissez "Installer cette application"';
//         } else {
//             instructions += '1. Cherchez l\'option "Ajouter √† l\'√©cran d\'accueil"\n' +
//                           '   ou "Installer l\'application" dans le menu\n' +
//                           '2. Confirmez l\'installation';
//         }
        
//         // Utiliser une modal plus jolie au lieu d'alert
//         this.showInstallModal(instructions);
//     }

//     showInstallModal(instructions) {
//         // Cr√©er une modal temporaire pour les instructions
//         const modal = document.createElement('div');
//         modal.style.cssText = `
//             position: fixed;
//             top: 0;
//             left: 0;
//             width: 100%;
//             height: 100%;
//             background-color: rgba(0,0,0,0.5);
//             z-index: 2000;
//             display: flex;
//             justify-content: center;
//             align-items: center;
//         `;
        
//         const modalContent = document.createElement('div');
//         modalContent.style.cssText = `
//             background-color: white;
//             padding: 20px;
//             border-radius: 10px;
//             max-width: 90%;
//             width: 300px;
//             box-shadow: 0 4px 6px rgba(0,0,0,0.1);
//             text-align: center;
//         `;
        
//         modalContent.innerHTML = `
//             <h3 style="margin-top: 0; color: #ff8c42;">üì± Installation manuelle</h3>
//             <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
//             <button id="close-install-modal" style="
//                 background-color: #ff8c42;
//                 color: white;
//                 border: none;
//                 padding: 10px 20px;
//                 border-radius: 4px;
//                 cursor: pointer;
//                 font-weight: bold;
//                 margin-top: 10px;
//             ">Compris</button>
//         `;
        
//         modal.appendChild(modalContent);
//         document.body.appendChild(modal);
        
//         // Fermer la modal
//         const closeBtn = modal.querySelector('#close-install-modal');
//         const closeModal = () => {
//             document.body.removeChild(modal);
//         };
        
//         closeBtn.addEventListener('click', closeModal);
//         modal.addEventListener('click', (e) => {
//             if (e.target === modal) closeModal();
//         });
        
//         // Auto-fermeture apr√®s 10 secondes
//         setTimeout(closeModal, 10000);
//     }

//     showUninstallModal(instructions) {
//         // Cr√©er une modal pour les instructions de d√©sinstallation
//         const modal = document.createElement('div');
//         modal.style.cssText = `
//             position: fixed;
//             top: 0;
//             left: 0;
//             width: 100%;
//             height: 100%;
//             background-color: rgba(0,0,0,0.5);
//             z-index: 2000;
//             display: flex;
//             justify-content: center;
//             align-items: center;
//         `;
        
//         const modalContent = document.createElement('div');
//         modalContent.style.cssText = `
//             background-color: white;
//             padding: 20px;
//             border-radius: 10px;
//             max-width: 90%;
//             width: 300px;
//             box-shadow: 0 4px 6px rgba(0,0,0,0.1);
//             text-align: center;
//         `;
        
//         modalContent.innerHTML = `
//             <h3 style="margin-top: 0; color: #ff4444;">üóëÔ∏è D√©sinstallation</h3>
//             <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
//             <button id="close-uninstall-modal" style="
//                 background-color: #ff4444;
//                 color: white;
//                 border: none;
//                 padding: 10px 20px;
//                 border-radius: 4px;
//                 cursor: pointer;
//                 font-weight: bold;
//                 margin-top: 10px;
//             ">Compris</button>
//         `;
        
//         modal.appendChild(modalContent);
//         document.body.appendChild(modal);
        
//         // Fermer la modal
//         const closeBtn = modal.querySelector('#close-uninstall-modal');
//         const closeModal = () => {
//             document.body.removeChild(modal);
//             // Apr√®s fermeture, remettre le bouton en mode installation si pas install√©
//             setTimeout(() => {
//                 if (!this.isAppInstalled()) {
//                     this.updateButtonContent();
//                 }
//             }, 1000);
//         };
        
//         closeBtn.addEventListener('click', closeModal);
//         modal.addEventListener('click', (e) => {
//             if (e.target === modal) closeModal();
//         });
        
//         // Auto-fermeture apr√®s 15 secondes
//         setTimeout(closeModal, 15000);
//     }

//     // M√©thode pour forcer la r√©initialisation (pour debug)
//     resetInstallState() {
//         localStorage.removeItem('pwa-installed');
//         this.deferredPrompt = null;
//         this.updateButtonContent();
//         console.log('[PWA Installer] √âtat d\'installation r√©initialis√©');
        
//         // Forcer la r√©apparition du bouton d'installation
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//             this.installButton.innerHTML = 'üì± Installer l\'application';
//         }
//     }

//     isAppInstalled() {
//         // Sur PC, difficile de d√©tecter si l'app est install√©e
//         // On se base sur le mode d'affichage ET on garde un √©tat en localStorage
//         const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
//                            window.navigator.standalone === true;
        
//         // V√©rifier aussi si on a un flag en localStorage
//         const wasInstalled = localStorage.getItem('pwa-installed') === 'true';
        
//         console.log('[PWA Installer] D√©tection installation - Standalone:', isStandalone, 'LocalStorage:', wasInstalled);
        
//         return isStandalone || wasInstalled;
//     }

//     checkInstallAvailability() {
//         // Mettre √† jour le contenu du bouton selon l'√©tat
//         this.updateButtonContent();
        
//         // Toujours afficher le bouton
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//         }
        
//         // Si l'app est d√©j√† install√©e, on a le bouton de d√©sinstallation
//         if (this.isAppInstalled()) {
//             console.log('[PWA Installer] Application d√©j√† install√©e - bouton de d√©sinstallation disponible');
//             return;
//         }

//         // Si pas install√©e, attendre un peu pour voir si l'√©v√©nement se d√©clenche
//         setTimeout(() => {
//             if (!this.deferredPrompt && this.installButton && !this.isAppInstalled()) {
//                 this.installButton.innerHTML = 'üì± Installer (manuel)';
//                 console.log('[PWA Installer] Bouton manuel affich√© (pas d\'√©v√©nement beforeinstallprompt)');
//             }
//         }, 3000);
//     }

//     // M√©thode publique pour afficher les instructions manuelles (utile pour debug/test)
//     showManualInstructions() {
//         this.showManualInstallInstructions();
//     }

//     // M√©thode publique pour forcer l'affichage (utile pour le debug)
//     forceShowInstallButton() {
//         if (!this.installButton) {
//             this.createInstallButton();
//         }
        
//         if (this.installButton) {
//             this.installButton.style.display = 'block';
//             this.updateButtonContent();
//             console.log('[PWA Installer] Bouton d\'installation forc√©');
//         }
//     }

//     // M√©thode publique pour v√©rifier l'√©tat
//     getStatus() {
//         return {
//             isInitialized: this.isInitialized,
//             hasPrompt: !!this.deferredPrompt,
//             isInstalled: this.isAppInstalled(),
//             buttonVisible: this.installButton ? this.installButton.style.display !== 'none' : false
//         };
//     }
// }

// // Cr√©er une instance globale
// window.pwaInstaller = new PWAInstaller();

// // Exposer quelques m√©thodes utiles pour le debug
// window.forceInstallPrompt = () => window.pwaInstaller.forceShowInstallButton();
// window.getPWAStatus = () => window.pwaInstaller.getStatus();
// window.showInstallInstructions = () => window.pwaInstaller.showManualInstructions();
// window.resetPWAState = () => window.pwaInstaller.resetInstallState();

// // Export pour les modules (optionnel)
// if (typeof module !== 'undefined' && module.exports) {
//     module.exports = PWAInstaller;
// }



























// // js/pwaInstaller.js
// // Version ultra-simple : UN SEUL bouton qui g√®re tout

// class PWAInstaller {
//     constructor() {
//         this.deferredPrompt = null;
//         this.installButton = null;
        
//         // Initialiser quand le DOM est pr√™t
//         if (document.readyState === 'loading') {
//             document.addEventListener('DOMContentLoaded', () => this.init());
//         } else {
//             this.init();
//         }
//     }

//     init() {
//         console.log('[PWA Installer] Initialisation ultra-simple...');
        
//         // √âcouter l'√©v√©nement d'installation
//         window.addEventListener('beforeinstallprompt', (e) => {
//             console.log('[PWA Installer] Installation PWA possible');
//             e.preventDefault();
//             this.deferredPrompt = e;
//             this.updateButton();
//         });
        
//         // √âcouter l'installation r√©ussie
//         window.addEventListener('appinstalled', (evt) => {
//             console.log('[PWA Installer] App install√©e');
//             this.deferredPrompt = null;
//             this.updateButton();
//         });
        
//         // Cr√©er le bouton
//         this.createButton();
//     }

//     createButton() {
//         // Trouver le conteneur dans la modal gedcom
//         const modalContent = document.querySelector('#gedcom-modal div[style*="padding: 20px"]');
//         if (!modalContent) {
//             console.warn('[PWA Installer] Conteneur de modal non trouv√©, tentative diff√©r√©e...');
//             setTimeout(() => this.createButton(), 1000);
//             return;
//         }

//         // Cr√©er LE bouton unique
//         this.installButton = document.createElement('button');
//         this.installButton.id = 'pwa-action-btn';
//         this.updateButton();
//         this.installButton.style.cssText = `
//             background-color: #ff8c42; 
//             color: white; 
//             border: none; 
//             padding: 10px; 
//             width: 100%; 
//             max-width: 240px; 
//             border-radius: 4px; 
//             cursor: pointer; 
//             font-weight: bold; 
//             margin: 0 auto 10px auto;
//             display: block;
//             box-sizing: border-box;
//         `;
//         this.installButton.addEventListener('click', () => this.handleClick());

//         // Ins√©rer le bouton avant le bouton "Activer les logs"
//         const debugBtn = document.getElementById('activateDebugLogsBtn');
//         if (debugBtn) {
//             debugBtn.parentNode.insertBefore(this.installButton, debugBtn);
//         } else {
//             modalContent.appendChild(this.installButton);
//         }
        
//         console.log('[PWA Installer] Bouton unique cr√©√©');
//     }

//     updateButton() {
//         if (!this.installButton) return;
        
//         if (this.isAppInstalled()) {
//             // App install√©e : proposer de la lancer
//             this.installButton.innerHTML = 'üöÄ Lancer l\'application';
//             this.installButton.style.backgroundColor = '#4CAF50';
//             this.installButton.setAttribute('data-text-key', 'lancerApp');
//         } else if (this.deferredPrompt) {
//             // Installation possible
//             this.installButton.innerHTML = 'üì± Installer l\'application';
//             this.installButton.style.backgroundColor = '#ff8c42';
//             this.installButton.setAttribute('data-text-key', 'installerApp');
//         } else {
//             // Pas d'installation auto possible
//             this.installButton.innerHTML = 'üí° Aide installation';
//             this.installButton.style.backgroundColor = '#2196F3';
//             this.installButton.setAttribute('data-text-key', 'aideInstallation');
//         }
//     }

//     handleClick() {
//         if (this.isAppInstalled()) {
//             // App install√©e : essayer de la lancer
//             this.launchApp();
//         } else if (this.deferredPrompt) {
//             // Installation automatique possible
//             this.installApp();
//         } else {
//             // Donner de l'aide pour l'installation
//             this.showInstallHelp();
//         }
//     }

//     async installApp() {
//         console.log('[PWA Installer] Installation automatique...');
        
//         try {
//             this.deferredPrompt.prompt();
//             const choiceResult = await this.deferredPrompt.userChoice;
            
//             if (choiceResult.outcome === 'accepted') {
//                 console.log('[PWA Installer] Installation accept√©e');
//                 this.showToast('‚úÖ Application install√©e avec succ√®s !', '#4CAF50');
//             } else {
//                 console.log('[PWA Installer] Installation refus√©e');
//                 this.showToast('‚ùå Installation annul√©e', '#ff9800');
//             }
            
//             this.deferredPrompt = null;
//             this.updateButton();
//         } catch (error) {
//             console.error('[PWA Installer] Erreur installation:', error);
//             this.showInstallHelp();
//         }
//     }

//     launchApp() {
//         // Essayer de d√©tecter l'URL de l'app install√©e
//         const appUrl = window.location.origin + window.location.pathname;
        
//         // Ouvrir dans un nouvel onglet pour simuler le lancement
//         const newWindow = window.open(appUrl, '_blank');
        
//         if (newWindow) {
//             this.showToast('üöÄ Application lanc√©e dans un nouvel onglet', '#4CAF50');
            
//             // Proposer des alternatives
//             setTimeout(() => {
//                 this.showModal('üöÄ Lancement de l\'application', 
//                     'L\'application s\'est ouverte dans un nouvel onglet.\n\n' +
//                     'üí° Pour la retrouver facilement :\n\n' +
//                     '‚Ä¢ Cherchez l\'ic√¥ne sur votre bureau\n' +
//                     '‚Ä¢ Ou dans le menu D√©marrer (Windows)\n' +
//                     '‚Ä¢ Ou dans le dock/Launchpad (Mac)\n' +
//                     '‚Ä¢ Ou tapez "TreeViewer" dans la recherche syst√®me\n\n' +
//                     '‚ùì Si vous ne trouvez pas l\'application, elle n\'est peut-√™tre pas install√©e correctement.');
//             }, 2000);
//         } else {
//             this.showModal('ü§î Application install√©e ?', 
//                 'Je ne peux pas lancer l\'application automatiquement.\n\n' +
//                 '‚úÖ Si elle est install√©e, cherchez :\n' +
//                 '‚Ä¢ L\'ic√¥ne sur votre bureau\n' +
//                 '‚Ä¢ Dans le menu D√©marrer\n' +
//                 '‚Ä¢ En tapant "TreeViewer" dans la recherche\n\n' +
//                 '‚ùì Si vous ne la trouvez pas, utilisez le bouton "Aide installation" pour r√©installer.');
//         }
//     }

//     showInstallHelp() {
//         const isChrome = navigator.userAgent.includes('Chrome') && !navigator.userAgent.includes('Edge');
//         const isEdge = navigator.userAgent.includes('Edge');
//         const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
//         let title = 'üí° Comment installer l\'application';
//         let instructions = '';
        
//         if (isMobile) {
//             if (navigator.userAgent.includes('Chrome')) {
//                 instructions = 'CHROME MOBILE :\n\n' +
//                               '1. Appuyez sur le menu (‚ãÆ) en haut √† droite\n' +
//                               '2. Cherchez "Ajouter √† l\'√©cran d\'accueil"\n' +
//                               '3. Confirmez l\'installation\n\n' +
//                               '‚úÖ L\'ic√¥ne appara√Ætra sur votre √©cran d\'accueil !';
//             } else if (navigator.userAgent.includes('Safari')) {
//                 instructions = 'SAFARI MOBILE :\n\n' +
//                               '1. Appuyez sur le bouton Partager üì§\n' +
//                               '2. Faites d√©filer et appuyez sur "Sur l\'√©cran d\'accueil"\n' +
//                               '3. Confirmez l\'ajout\n\n' +
//                               '‚úÖ L\'ic√¥ne appara√Ætra sur votre √©cran d\'accueil !';
//             } else {
//                 instructions = 'MOBILE :\n\n' +
//                               'Cherchez dans le menu de votre navigateur :\n' +
//                               '‚Ä¢ "Ajouter √† l\'√©cran d\'accueil"\n' +
//                               '‚Ä¢ "Installer l\'application"\n' +
//                               '‚Ä¢ "Cr√©er un raccourci"\n\n' +
//                               '‚úÖ L\'ic√¥ne appara√Ætra sur votre √©cran d\'accueil !';
//             }
//         } else {
//             if (isChrome) {
//                 instructions = 'CHROME PC :\n\n' +
//                               'üîç Regardez dans la barre d\'adresse :\n' +
//                               '‚Ä¢ Une ic√¥ne "Installer" ‚äï peut appara√Ætre\n' +
//                               '‚Ä¢ Cliquez dessus si vous la voyez\n\n' +
//                               'üìã OU dans le menu Chrome :\n' +
//                               '‚Ä¢ Menu (‚ãÆ) ‚Üí "Installer TreeViewer"\n' +
//                               '‚Ä¢ Menu (‚ãÆ) ‚Üí Plus d\'outils ‚Üí Applications\n\n' +
//                               '‚úÖ Un raccourci appara√Ætra sur votre bureau !';
//             } else if (isEdge) {
//                 instructions = 'EDGE PC :\n\n' +
//                               'üîç Regardez dans la barre d\'adresse :\n' +
//                               '‚Ä¢ Une ic√¥ne "Installer" peut appara√Ætre\n' +
//                               '‚Ä¢ Cliquez dessus si vous la voyez\n\n' +
//                               'üìã OU dans le menu Edge :\n' +
//                               '‚Ä¢ Menu (‚ãØ) ‚Üí Applications\n' +
//                               '‚Ä¢ "Installer ce site en tant qu\'application"\n\n' +
//                               '‚úÖ Un raccourci appara√Ætra sur votre bureau !';
//             } else {
//                 instructions = 'NAVIGATEUR PC :\n\n' +
//                               'Cherchez dans votre navigateur :\n' +
//                               '‚Ä¢ Une ic√¥ne "Installer" dans la barre d\'adresse\n' +
//                               '‚Ä¢ Menu ‚Üí "Installer cette application"\n' +
//                               '‚Ä¢ Menu ‚Üí "Applications"\n\n' +
//                               'üìù Si rien n\'appara√Æt, votre navigateur ne supporte\n' +
//                               'peut-√™tre pas l\'installation d\'applications web.';
//             }
//         }
        
//         this.showModal(title, instructions);
//     }

//     isAppInstalled() {
//         // D√©tection simple bas√©e sur le mode d'affichage
//         return window.matchMedia('(display-mode: standalone)').matches ||
//                window.navigator.standalone === true;
//     }

//     showModal(title, content) {
//         const modal = document.createElement('div');
//         modal.style.cssText = `
//             position: fixed;
//             top: 0;
//             left: 0;
//             width: 100%;
//             height: 100%;
//             background-color: rgba(0,0,0,0.5);
//             z-index: 2000;
//             display: flex;
//             justify-content: center;
//             align-items: center;
//         `;
        
//         const modalContent = document.createElement('div');
//         modalContent.style.cssText = `
//             background-color: white;
//             padding: 20px;
//             border-radius: 10px;
//             max-width: 90%;
//             max-height: 80%;
//             width: 400px;
//             box-shadow: 0 4px 6px rgba(0,0,0,0.1);
//             text-align: center;
//             overflow-y: auto;
//         `;
        
//         modalContent.innerHTML = `
//             <h3 style="margin-top: 0; color: #333;">${title}</h3>
//             <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0; font-size: 14px;">${content}</p>
//             <button id="close-modal" style="
//                 background-color: #4CAF50;
//                 color: white;
//                 border: none;
//                 padding: 10px 20px;
//                 border-radius: 4px;
//                 cursor: pointer;
//                 font-weight: bold;
//                 margin-top: 10px;
//             ">Compris</button>
//         `;
        
//         modal.appendChild(modalContent);
//         document.body.appendChild(modal);
        
//         const closeBtn = modal.querySelector('#close-modal');
//         const closeModal = () => document.body.removeChild(modal);
        
//         closeBtn.addEventListener('click', closeModal);
//         modal.addEventListener('click', (e) => {
//             if (e.target === modal) closeModal();
//         });
        
//         setTimeout(closeModal, 30000);
//     }

//     showToast(message, color = '#4CAF50') {
//         const toast = document.createElement('div');
//         toast.style.cssText = `
//             position: fixed;
//             top: 20px;
//             right: 20px;
//             background-color: ${color};
//             color: white;
//             padding: 15px;
//             border-radius: 5px;
//             z-index: 3000;
//             font-weight: bold;
//             max-width: 300px;
//         `;
//         toast.textContent = message;
        
//         document.body.appendChild(toast);
//         setTimeout(() => document.body.removeChild(toast), 4000);
//     }
// }

// // Cr√©er une instance globale
// window.pwaInstaller = new PWAInstaller();

// // Fonction globale pour debug
// window.testPWA = () => {
//     console.log('PWA Status:', {
//         deferredPrompt: !!window.pwaInstaller.deferredPrompt,
//         isInstalled: window.pwaInstaller.isAppInstalled(),
//         userAgent: navigator.userAgent
//     });
// };




















// js/pwaInstaller.js
// Gestionnaire d'installation PWA

class PWAInstaller {
    constructor() {
        this.deferredPrompt = null;
        this.installButton = null;
        this.isInitialized = false;
        
        // Initialiser quand le DOM est pr√™t
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => this.init());
        } else {
            this.init();
        }
    }

    init() {
        if (this.isInitialized) return;
        
        console.log('[PWA Installer] Initialisation...');
        
        // √âcouter l'√©v√©nement d'installation
        this.setupInstallPromptListener();
        
        // √âcouter l'√©v√©nement d'installation r√©ussie
        this.setupInstallSuccessListener();
        
        // Cr√©er le bouton d'installation
        this.createInstallButton();
        
        // V√©rifier si on peut d√©j√† afficher le bouton
        this.checkInstallAvailability();
        
        this.isInitialized = true;
        console.log('[PWA Installer] Initialis√© avec succ√®s');
    }

    setupInstallPromptListener() {
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('[PWA Installer] beforeinstallprompt d√©clench√©');
            
            // Emp√™cher l'affichage automatique
            e.preventDefault();
            
            // Stocker l'√©v√©nement
            this.deferredPrompt = e;
            
            // Afficher le bouton
            this.showInstallButton();
        });
    }

    setupInstallSuccessListener() {
        window.addEventListener('appinstalled', (evt) => {
            console.log('[PWA Installer] Application install√©e avec succ√®s');
            this.updateButtonForInstalledState();
            this.deferredPrompt = null;
        });
    }

    createInstallButton() {
        // V√©rifier si le bouton existe d√©j√†
        if (this.installButton) return;

        // Trouver le conteneur dans la modal gedcom
        const modalContent = document.querySelector('#gedcom-modal div[style*="padding: 20px"]');
        if (!modalContent) {
            console.warn('[PWA Installer] Conteneur de modal non trouv√©, tentative diff√©r√©e...');
            // R√©essayer plus tard
            setTimeout(() => this.createInstallButton(), 1000);
            return;
        }

        // Cr√©er le bouton d'installation
        this.installButton = document.createElement('button');
        this.installButton.id = 'install-app-btn';
        this.updateButtonContent();
        this.installButton.style.cssText = `
            background-color: #ff8c42; 
            color: white; 
            border: none; 
            padding: 10px; 
            width: 100%; 
            max-width: 240px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold; 
            margin: 0 auto 10px auto;
            display: none;
            box-sizing: border-box;
        `;
        
        // Ajouter l'√©v√©nement click
        this.installButton.addEventListener('click', () => {
            if (this.isAppInstalled()) {
                this.uninstallApp();
            } else {
                this.installApp();
            }
        });
        
        // Ins√©rer le bouton avant le bouton "Activer les logs"
        const debugBtn = document.getElementById('activateDebugLogsBtn');
        if (debugBtn) {
            debugBtn.parentNode.insertBefore(this.installButton, debugBtn);
        } else {
            // Fallback : ajouter √† la fin du conteneur
            modalContent.appendChild(this.installButton);
        }
        
        console.log('[PWA Installer] Bouton d\'installation/d√©sinstallation cr√©√©');
    }

    updateButtonContent() {
        if (!this.installButton) return;
        
        if (this.isAppInstalled()) {
            this.installButton.innerHTML = 'üì± D√©sinstaller l\'application';
            this.installButton.setAttribute('data-text-key', 'desinstallerApp');
        } else {
            this.installButton.innerHTML = 'üì± Installer l\'application';
            this.installButton.setAttribute('data-text-key', 'installerApp');
        }
    }

    updateButtonForInstalledState() {
        this.updateButtonContent();
        if (this.installButton) {
            this.installButton.style.display = 'block';
        }
    }

    showInstallButton() {
        if (this.installButton) {
            this.installButton.style.display = 'block';
            this.updateButtonContent();
            console.log('[PWA Installer] Bouton d\'installation affich√©');
        }
    }

    hideInstallButton() {
        if (this.installButton) {
            this.installButton.style.display = 'none';
            console.log('[PWA Installer] Bouton d\'installation masqu√©');
        }
    }

    async installApp() {
        console.log('[PWA Installer] Tentative d\'installation...');
        
        if (this.deferredPrompt) {
            try {
                // Afficher la popup d'installation
                this.deferredPrompt.prompt();
                
                // Attendre le choix de l'utilisateur
                const choiceResult = await this.deferredPrompt.userChoice;
                
                if (choiceResult.outcome === 'accepted') {
                    console.log('[PWA Installer] Installation accept√©e par l\'utilisateur');
                    // Le bouton sera mis √† jour par l'√©v√©nement 'appinstalled'
                } else {
                    console.log('[PWA Installer] Installation refus√©e par l\'utilisateur');
                }
                
                this.deferredPrompt = null;
            } catch (error) {
                console.error('[PWA Installer] Erreur lors de l\'installation:', error);
                this.showManualInstallInstructions();
            }
        } else {
            // Pas d'√©v√©nement beforeinstallprompt disponible
            this.showManualInstallInstructions();
        }
    }

    async uninstallApp() {
        console.log('[PWA Installer] Tentative de d√©sinstallation...');
        
        // Instructions de d√©sinstallation
        const userAgent = navigator.userAgent.toLowerCase();
        let instructions = 'Pour d√©sinstaller cette application :\n\n';
        
        if (userAgent.includes('chrome') && userAgent.includes('mobile')) {
            instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'app\n' +
                          '2. S√©lectionnez "D√©sinstaller" ou glissez vers "Supprimer"\n' +
                          '3. Confirmez la suppression';
        } else if (userAgent.includes('safari') && userAgent.includes('mobile')) {
            instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'app\n' +
                          '2. Appuyez sur le "X" qui appara√Æt\n' +
                          '3. Confirmez la suppression';
        } else {
            instructions += '1. Maintenez appuy√© sur l\'ic√¥ne de l\'application\n' +
                          '2. S√©lectionnez "D√©sinstaller" ou "Supprimer"\n' +
                          '3. Confirmez la suppression\n\n' +
                          'Ou allez dans les param√®tres du navigateur :\n' +
                          '‚Ä¢ Applications install√©es\n' +
                          '‚Ä¢ Trouvez cette app et d√©sinstallez-la';
        }
        
        this.showUninstallModal(instructions);
    }

    async uninstallApp() {
        console.log('[PWA Installer] Tentative de d√©sinstallation...');
        
        // Obtenir les traductions selon la langue actuelle
        const currentLang = window.i18n ? window.i18n.getCurrentLanguage() : 'fr';
        const getText = (key) => window.i18n ? window.i18n.getText(key) : key;
        
        // D√©tection du navigateur et de la plateforme
        const userAgent = navigator.userAgent.toLowerCase();
        const isChrome = userAgent.includes('chrome') && !userAgent.includes('edge');
        const isEdge = userAgent.includes('edge');
        const isMobile = /android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
        
        let instructions = getText('desinstallationInstructions') + '\n\n';
        
        if (isMobile) {
            // Instructions mobiles
            if (userAgent.includes('chrome')) {
                instructions += getText('chromeMobileDesinstall');
            } else if (userAgent.includes('safari')) {
                instructions += getText('safariMobileDesinstall');
            } else {
                instructions += getText('genericDesinstall');
            }
        } else {
            // Instructions PC
            if (isChrome) {
                instructions += getText('chromePCDesinstall');
            } else if (isEdge) {
                instructions += getText('edgePCDesinstall');
            } else {
                instructions += getText('genericDesinstall');
            }
        }
        
        this.showUninstallModal(instructions);
    }


    showManualInstallInstructions() {
        const userAgent = navigator.userAgent.toLowerCase();
        let instructions = 'Pour installer cette application :\n\n';
        
        if (userAgent.includes('chrome') && userAgent.includes('mobile')) {
            instructions += '1. Appuyez sur le menu du navigateur (‚ãÆ)\n' +
                          '2. S√©lectionnez "Ajouter √† l\'√©cran d\'accueil"\n' +
                          '3. Confirmez l\'installation';
        } else if (userAgent.includes('safari') && userAgent.includes('mobile')) {
            instructions += '1. Appuyez sur le bouton Partager\n' +
                          '2. S√©lectionnez "Sur l\'√©cran d\'accueil"\n' +
                          '3. Confirmez l\'ajout';
        } else if (userAgent.includes('edge')) {
            instructions += '1. Appuyez sur le menu (‚ãØ)\n' +
                          '2. S√©lectionnez "Applications"\n' +
                          '3. Choisissez "Installer cette application"';
        } else {
            instructions += '1. Cherchez l\'option "Ajouter √† l\'√©cran d\'accueil"\n' +
                          '   ou "Installer l\'application" dans le menu\n' +
                          '2. Confirmez l\'installation';
        }
        
        // Utiliser une modal plus jolie au lieu d'alert
        this.showInstallModal(instructions);
    }

    showInstallModal(instructions) {
        // Cr√©er une modal temporaire pour les instructions
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        `;
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            width: 300px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        `;
        
        modalContent.innerHTML = `
            <h3 style="margin-top: 0; color: #ff8c42;">üì± Installation manuelle</h3>
            <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
            <button id="close-install-modal" style="
                background-color: #ff8c42;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                font-weight: bold;
                margin-top: 10px;
            ">Compris</button>
        `;
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Fermer la modal
        const closeBtn = modal.querySelector('#close-install-modal');
        const closeModal = () => {
            document.body.removeChild(modal);
        };
        
        closeBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        
        // Auto-fermeture apr√®s 10 secondes
        setTimeout(closeModal, 10000);
    }

    // showUninstallModal(instructions) {
    //     // Cr√©er une modal pour les instructions de d√©sinstallation
    //     const modal = document.createElement('div');
    //     modal.style.cssText = `
    //         position: fixed;
    //         top: 0;
    //         left: 0;
    //         width: 100%;
    //         height: 100%;
    //         background-color: rgba(0,0,0,0.5);
    //         z-index: 2000;
    //         display: flex;
    //         justify-content: center;
    //         align-items: center;
    //     `;
        
    //     const modalContent = document.createElement('div');
    //     modalContent.style.cssText = `
    //         background-color: white;
    //         padding: 20px;
    //         border-radius: 10px;
    //         max-width: 90%;
    //         width: 300px;
    //         box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    //         text-align: center;
    //     `;
        
    //     modalContent.innerHTML = `
    //         <h3 style="margin-top: 0; color: #ff4444;">üóëÔ∏è D√©sinstallation</h3>
    //         <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
    //         <button id="close-uninstall-modal" style="
    //             background-color: #ff4444;
    //             color: white;
    //             border: none;
    //             padding: 10px 20px;
    //             border-radius: 4px;
    //             cursor: pointer;
    //             font-weight: bold;
    //             margin-top: 10px;
    //         ">Compris</button>
    //     `;
        
    //     modal.appendChild(modalContent);
    //     document.body.appendChild(modal);
        
    //     // Fermer la modal
    //     const closeBtn = modal.querySelector('#close-uninstall-modal');
    //     const closeModal = () => {
    //         document.body.removeChild(modal);
    //         // Apr√®s fermeture, remettre le bouton en mode installation si pas install√©
    //         setTimeout(() => {
    //             if (!this.isAppInstalled()) {
    //                 this.updateButtonContent();
    //             }
    //         }, 1000);
    //     };
        
    //     closeBtn.addEventListener('click', closeModal);
    //     modal.addEventListener('click', (e) => {
    //         if (e.target === modal) closeModal();
    //     });
        
    //     // Auto-fermeture apr√®s 15 secondes
    //     setTimeout(closeModal, 15000);
    // }

    showUninstallModal(instructions) {
        const getText = (key) => window.i18n ? window.i18n.getText(key) : key;
        
        // Cr√©er une modal pour les instructions de d√©sinstallation
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        `;
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            width: 300px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        `;
        
        modalContent.innerHTML = `
            <h3 style="margin-top: 0; color: #ff4444;">${getText('desinstallationTitle')}</h3>
            <p style="white-space: pre-line; text-align: left; line-height: 1.4; margin: 15px 0;">${instructions}</p>
            <button id="close-uninstall-modal" style="
                background-color: #ff4444;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                font-weight: bold;
                margin-top: 10px;
            ">${getText('compris')}</button>
        `;
        
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Fermer la modal
        const closeBtn = modal.querySelector('#close-uninstall-modal');
        const closeModal = () => {
            document.body.removeChild(modal);
            // Apr√®s fermeture, remettre le bouton en mode installation si pas install√©
            setTimeout(() => {
                if (!this.isAppInstalled()) {
                    this.updateButtonContent();
                }
            }, 1000);
        };
        
        closeBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        
        // Auto-fermeture apr√®s 15 secondes
        setTimeout(closeModal, 15000);
    }

    isAppInstalled() {
        // V√©rifier si l'app est lanc√©e en mode standalone
        return window.matchMedia('(display-mode: standalone)').matches ||
               window.navigator.standalone === true;
    }

    checkInstallAvailability() {
        // Mettre √† jour le contenu du bouton selon l'√©tat
        this.updateButtonContent();
        
        // Toujours afficher le bouton
        if (this.installButton) {
            this.installButton.style.display = 'block';
        }
        
        // Si l'app est d√©j√† install√©e, on a le bouton de d√©sinstallation
        if (this.isAppInstalled()) {
            console.log('[PWA Installer] Application d√©j√† install√©e - bouton de d√©sinstallation disponible');
            return;
        }

        // Si pas install√©e, attendre un peu pour voir si l'√©v√©nement se d√©clenche
        setTimeout(() => {
            if (!this.deferredPrompt && this.installButton && !this.isAppInstalled()) {
                this.installButton.innerHTML = 'üì± Installer (manuel)';
                console.log('[PWA Installer] Bouton manuel affich√© (pas d\'√©v√©nement beforeinstallprompt)');
            }
        }, 3000);
    }

    // M√©thode publique pour afficher les instructions manuelles (utile pour debug/test)
    showManualInstructions() {
        this.showManualInstallInstructions();
    }

    // M√©thode publique pour forcer l'affichage (utile pour le debug)
    forceShowInstallButton() {
        if (!this.installButton) {
            this.createInstallButton();
        }
        
        if (this.installButton) {
            this.installButton.style.display = 'block';
            this.updateButtonContent();
            console.log('[PWA Installer] Bouton d\'installation forc√©');
        }
    }

    // M√©thode publique pour v√©rifier l'√©tat
    getStatus() {
        return {
            isInitialized: this.isInitialized,
            hasPrompt: !!this.deferredPrompt,
            isInstalled: this.isAppInstalled(),
            buttonVisible: this.installButton ? this.installButton.style.display !== 'none' : false
        };
    }
}

// Cr√©er une instance globale
window.pwaInstaller = new PWAInstaller();

// Exposer quelques m√©thodes utiles pour le debug
window.forceInstallPrompt = () => window.pwaInstaller.forceShowInstallButton();
window.getPWAStatus = () => window.pwaInstaller.getStatus();
window.showInstallInstructions = () => window.pwaInstaller.showManualInstructions();

// Export pour les modules (optionnel)
if (typeof module !== 'undefined' && module.exports) {
    module.exports = PWAInstaller;
}


