
// Cr√©er un objet global imm√©diatement disponible
window.i18n = {
  // Langue actuelle
  currentLanguage: 'fr',
  
  // Dictionnaire complet avec toutes les cl√©s
  translations: {
    'fr': {
      // Page password-form
      'motDePasse': 'Mot de passe',
      'visualiserArbre': 'Visualiser l\'arbre',
      
      // Modal GEDCOM
      'chargerGedcom': 'Charger un fichier GEDCOM',
      'afficherArbre': 'Afficher l\'arbre',
      'viderCache': 'Vider le cache',
      'activerLogs': 'Activer les logs de debug',
      
      // Contr√¥les de l'arbre
      'rootPersonSearch': 'üîçracine',
      'nbreGene': 'nbre<br>g√©n√©',
      'choisirFichier': 'Choisir un fichier',
      'aucunFichier': 'Aucun fichier choisi',

    },
    'en': {
      // Page password-form
      'motDePasse': 'Password',
      'visualiserArbre': 'View family tree',
      
      // Modal GEDCOM
      'chargerGedcom': 'Load GEDCOM file',
      'afficherArbre': 'Show tree',
      'viderCache': 'Clear cache',
      'activerLogs': 'Enable debug logs',
      
      // Contr√¥les de l'arbre
      'rootPersonSearch': 'üîçroot',
      'nbreGene': 'gene.<br>count',
      'choisirFichier': 'Choose file',
      'aucunFichier': 'No file chosen',

    },
    'es': {
      // Page password-form
      'motDePasse': 'Contrase√±a',
      'visualiserArbre': 'Ver √°rbol geneal√≥gico',
      
      // Modal GEDCOM
      'chargerGedcom': 'Cargar archivo GEDCOM',
      'afficherArbre': 'Mostrar √°rbol',
      'viderCache': 'Limpiar cach√©',
      'activerLogs': 'Activar logs de depuraci√≥n',
      
      // Contr√¥les de l'arbre
      'rootPersonSearch': 'üîçra√≠z',
      'nbreGene': 'n√∫m.<br>gene.',
      'choisirFichier': 'Seleccionar archivo',
      'aucunFichier': 'Ning√∫n archivo seleccionado',

    },
    'hu': {
      // Page password-form
      'motDePasse': 'Jelsz√≥',
      'visualiserArbre': 'Csal√°dfa megtekint√©se',
      
      // Modal GEDCOM
      'chargerGedcom': 'GEDCOM f√°jl bet√∂lt√©se',
      'afficherArbre': 'Fa megjelen√≠t√©se',
      'viderCache': 'Gyors√≠t√≥t√°r t√∂rl√©se',
      'activerLogs': 'Hibakeres√©si napl√≥k enged√©lyez√©se',
      'choisirFichier': 'F√°jl kiv√°laszt√°sa',
      'aucunFichier': 'Nincs kiv√°lasztott f√°jl',
      
      // Contr√¥les de l'arbre
      'rootPersonSearch': 'üîçgy√∂k√©r',
      'nbreGene': 'gene.<br>sz√°m'
    }
  },
  









  // Fonction de changement de langue
  changeLanguage: function(lang) {
    console.log("Changement de langue vers: " + lang);
    
    if (this.translations[lang]) {
      this.currentLanguage = lang;
      this.updateUI();
      
      // Mise √† jour visuelle du s√©lecteur de langue
      document.querySelectorAll('.lang-flag').forEach(function(flag) {
        if (flag.getAttribute('data-lang') === lang) {
          flag.classList.add('active');
        } else {
          flag.classList.remove('active');
        }
      });


      // Mettre √† jour les tooltip et toasts si la fonction de mainUI existe
      if (typeof window.applyTextDefinitions === 'function' && window.texts) {
        // Mettre √† jour l'objet texts de mainUI avec les traductions actuelles
        updateMainUITexts();
        
        // Appliquer les traductions mises √† jour
        window.applyTextDefinitions();
      }





      
      // Sauvegarder la pr√©f√©rence
      localStorage.setItem('preferredLanguage', lang);
      
      // Cr√©er variable globale
      window.CURRENT_LANGUAGE = lang;
    }
  },
  
  // Fonction pour mettre √† jour l'interface
  updateUI: function() {
    console.log("Mise √† jour de l'interface en: " + this.currentLanguage);
    
    // G√©rer les √©l√©ments avec data-text-key
    document.querySelectorAll('[data-text-key]').forEach(element => {
      const key = element.getAttribute('data-text-key');
      
      // V√©rifier si la cl√© existe dans le dictionnaire
      if (this.translations[this.currentLanguage] && 
          this.translations[this.currentLanguage][key]) {
        
        // Traiter diff√©remment selon le type d'√©l√©ment
        if (element.tagName === 'INPUT') {
          console.log("Mise √† jour du placeholder pour: " + key);
          element.placeholder = this.translations[this.currentLanguage][key];
        } else if (key === 'nbreGene') {
          // Cas sp√©cial pour les √©l√©ments avec HTML (comme <br>)
          element.innerHTML = this.translations[this.currentLanguage][key];
        } else {
          console.log("Mise √† jour du texte pour: " + key);
          element.textContent = this.translations[this.currentLanguage][key];
        }


        // Ajouter ceci pour mettre √† jour les attributs title et data-action
        if (element.hasAttribute('title')) {
          element.setAttribute('title', this.translations[this.currentLanguage][key]);
        }
        if (element.hasAttribute('data-action')) {
          element.setAttribute('data-action', this.translations[this.currentLanguage][key]);
        }
      }
    });



  },
  
  // Obtenir la langue actuelle
  getCurrentLanguage: function() {
    return this.currentLanguage;
  },
  
  // Obtenir une traduction
  getText: function(key) {
    if (this.translations[this.currentLanguage] && 
        this.translations[this.currentLanguage][key]) {
      return this.translations[this.currentLanguage][key];
    }
    
    // Fallback au fran√ßais
    if (this.translations['fr'] && this.translations['fr'][key]) {
      return this.translations['fr'][key];
    }
    
    return key;
  },
  
  // Initialiser
  init: function() {
    // Charger la langue pr√©f√©r√©e
    const savedLang = localStorage.getItem('preferredLanguage');
    if (savedLang && this.translations[savedLang]) {
      this.currentLanguage = savedLang;
    }
    
    // Initialiser la variable globale
    window.CURRENT_LANGUAGE = this.currentLanguage;
    
    console.log("Initialisation avec la langue: " + this.currentLanguage);
    this.updateUI();
    
    // Mettre √† jour l'apparence des drapeaux
    const currentLang = this.currentLanguage;
    document.querySelectorAll('.lang-flag').forEach(function(flag) {
      if (flag.getAttribute('data-lang') === currentLang) {
        flag.classList.add('active');
      } else {
        flag.classList.remove('active');
      }
    });

    // Mettre √† jour les textes de mainUI si disponible
    if (window.texts && typeof window.applyTextDefinitions === 'function') {
      updateMainUITexts();
      window.applyTextDefinitions();
    }
  }
};




// Fonction pour mettre √† jour l'objet texts de mainUI avec les traductions actuelles
function updateMainUITexts() {
  // S'assurer que l'objet texts existe
  if (!window.texts) {
    window.texts = {};
  }

  // Liste des cl√©s utilis√©es dans mainUI.texts
  const mainUIKeys = [
    'zoomIn', 'zoomOut', 'resetZoom', 'toggleSpeech', 'toggleAnimationPause',
    'openSettingsModal', 'toggleFullScreen', 'processNamesCloudWithDate',
    'rootPersonSearch', 'rootPersonResults', 'updateGenerations', 'treeMode',
    'treeModeAncestors', 'treeModeDescendants', 'treeModeBoth', 'search', 'prenoms'
  ];

  // Mettre √† jour l'objet texts avec les traductions actuelles
  mainUIKeys.forEach(key => {
    if (window.i18n.translations[window.i18n.currentLanguage] && 
        window.i18n.translations[window.i18n.currentLanguage][key]) {
      window.texts[key] = window.i18n.translations[window.i18n.currentLanguage][key];
    }
  });
}











// Initialiser quand la page est charg√©e
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM charg√©, initialisation du syst√®me de langue");
  window.i18n.init();
});

// Surcharger la fonction openGedcomModal pour mettre √† jour les traductions
// Attention, cette partie doit √™tre ex√©cut√©e APR√àS que openGedcomModal est d√©finie
document.addEventListener('DOMContentLoaded', function() {
  if (typeof window.openGedcomModal === 'function') {
    const originalOpenGedcomModal = window.openGedcomModal;
    window.openGedcomModal = function() {
      // Appeler la fonction originale
      originalOpenGedcomModal();
      
      // Mettre √† jour les traductions apr√®s un court d√©lai
      setTimeout(function() {
        if (window.i18n) {
          window.i18n.updateUI();
        }
      }, 100);
    };
  } else {
    console.warn("La fonction openGedcomModal n'est pas encore d√©finie");
  }
});

// Cr√©er la variable globale directement
window.CURRENT_LANGUAGE = localStorage.getItem('preferredLanguage') || 'fr';