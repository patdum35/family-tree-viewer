<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbre g√©n√©alogique</title>
    
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    
    <!-- Biblioth√®ques externes -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.3/pako.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
</head>
<body>
    <!-- Formulaire de mot de passe -->
    <div id="password-form">
        <div class="form-container">
            <div class="password-row">
                <input type="password" id="password" placeholder="Mot de passe (pour fichier crypt√©)">
            </div>
            <div class="or-row">
                <div>ou</div>
            </div>
            <div class="file-row">
                <input type="file" id="gedFile" accept=".ged">
            </div>
            <div style="margin-top: -15px; margin-bottom: 20px; ">
                <label style="text-align: left; display: block; margin-left:15px">GEDCOM<br></label>
            </div>
            <div class="submit-row">
                <button id="loadDataButton">Afficher l'arbre</button>
            </div>
        </div>
    </div>

    <!-- Conteneur de l'arbre -->
    <div id="tree-container" style="display: none;">
        <div class="controls">
            <div class="controls-row-1">
                <button onclick="zoomIn()">‚ûï</button>
                <button onclick="zoomOut()">‚ûñ</button>
                <button onclick="resetZoom()">üè†</button>
                <input type="text" id="search" placeholder="üîçnom" oninput="searchTree(this.value)">
                <input type="text" id="root-person-search" placeholder="üîçracine" inputmode="text" enterkeyhint="next">
                <select id="root-person-results" style="display:block;">
                    <option value="">Select</option>
                </select>
            </div>
            <div class="controls-row-2">
                <label for="prenoms">nbre<br>pr√©nom</label>
                <select id="prenoms" onchange="updatePrenoms(this.value)">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
                <label for="generations">nbre<br>g√©n√©</label>
                <select id="generations" onchange="updateGenerations(this.value)">
                </select>
                <select id="treeMode" onchange="updateTreeMode(this.value)">
                    <option value="ancestors" selected>Ascendants</option>
                    <option value="descendants">Descendants</option>
                    <option value="both">Ascend.+Descend.</option>
                </select>
            </div>
        </div>

        <svg id="tree-svg"></svg>
    </div>

    <!-- Fen√™tre modale pour les d√©tails -->
    <div id="person-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-person-name"></h2>
                <span class="modal-close" onclick="closePersonDetails()">&times;</span>
            </div>
            <div id="person-details-content"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { 
            loadData, 
            updatePrenoms, 
            updateGenerations, 
            zoomIn, 
            zoomOut, 
            resetZoom, 
            searchTree,
            displayPersonDetails,
            closePersonDetails,
            setAsRootPerson,
            updateTreeMode,
            handleRootPersonChange   
        } from './js/main.js';
        import { 
            startAncestorAnimation 
        } from './js/treeAnimation.js';

        // Rendre les fonctions disponibles globalement
        window.loadData = loadData;
        window.updatePrenoms = updatePrenoms;
        window.updateGenerations = updateGenerations;
        window.zoomIn = zoomIn;
        window.zoomOut = zoomOut;
        window.resetZoom = resetZoom;
        window.searchTree = searchTree;
        window.displayPersonDetails = displayPersonDetails;
        window.closePersonDetails = closePersonDetails;
        window.setAsRootPerson = setAsRootPerson; 
        window.updateTreeMode = updateTreeMode; 
        window.handleRootPersonChange = handleRootPersonChange;
        window.startAnimation = () => {
            startAncestorAnimation().catch(console.error);
        };

        // Ajouter les √©couteurs d'√©v√©nements une fois que tout est charg√©
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('loadDataButton').addEventListener('click', loadData);
            document.getElementById('root-person-results')
                .addEventListener('change', handleRootPersonChange);
        });

    </script>
</body>
</html>